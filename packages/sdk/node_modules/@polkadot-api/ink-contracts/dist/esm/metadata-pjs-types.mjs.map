{"version":3,"file":"metadata-pjs-types.mjs","sources":["../../src/metadata-pjs-types.ts"],"sourcesContent":["import {\n  _void,\n  Codec,\n  CodecType,\n  compactNumber,\n  enhanceCodec,\n  Option,\n  ScaleEnum,\n  str,\n  StringRecord,\n  Struct,\n  u32,\n  u8,\n  Vector,\n} from \"@polkadot-api/substrate-bindings\"\n\ntype PjsVariant<O extends StringRecord<Codec<any>>> = {\n  [K in keyof O]: {\n    [KK in K]: CodecType<O[K]>\n  }\n}[keyof O]\nconst Variant = <O extends StringRecord<Codec<any>>>(inner: O) =>\n  enhanceCodec(\n    ScaleEnum(inner),\n    (value: PjsVariant<O>) => {\n      if (typeof value === \"string\") {\n        return {\n          tag: value,\n          value: undefined,\n        } as any\n      }\n      const [tag, val] = Object.entries(value)[0]\n\n      return {\n        tag: tag as keyof O,\n        value: val,\n      }\n    },\n    (value) => {\n      return {\n        [value.tag]: value.value,\n      } as PjsVariant<O>\n    },\n  )\n\n// Seems like pjs can omit empty vectors\nconst PjsVector = <T>(inner: Codec<T>, size?: number) =>\n  enhanceCodec(\n    Vector(inner, size),\n    (value: T[] | undefined) => value ?? [],\n    (v) => v,\n  )\n\nconst oStr = Option(str)\nconst docs = PjsVector(str)\n\nconst primitive = Variant({\n  bool: _void,\n  char: _void,\n  str: _void,\n  u8: _void,\n  u16: _void,\n  u32: _void,\n  u64: _void,\n  u128: _void,\n  u256: _void,\n  i8: _void,\n  i16: _void,\n  i32: _void,\n  i64: _void,\n  i128: _void,\n  i256: _void,\n})\n\nconst fields = PjsVector(\n  Struct({\n    name: oStr,\n    type: compactNumber,\n    typeName: oStr,\n    docs,\n  }),\n)\n\nconst arr = Struct({\n  len: u32,\n  type: compactNumber,\n})\n\nconst bitSequence = Struct({\n  bitStoreType: compactNumber,\n  bitOrderType: compactNumber,\n})\n\nconst variants = PjsVector(\n  Struct({\n    name: str,\n    fields,\n    index: u8,\n    docs,\n  }),\n)\n\nconst def = Variant({\n  composite: Struct({\n    fields,\n  }),\n  variant: Struct({\n    variants,\n  }),\n  sequence: Struct({\n    type: compactNumber,\n  }),\n  array: arr,\n  tuple: Vector(compactNumber),\n  primitive,\n  compact: compactNumber,\n  bitSequence,\n})\n\nconst param = Struct({\n  name: str,\n  type: Option(compactNumber),\n})\nconst params = PjsVector(param)\n\nconst metadataEntry = Struct({\n  id: compactNumber,\n  path: docs,\n  params,\n  def,\n  docs,\n})\n\nconst entry = enhanceCodec(\n  metadataEntry,\n  (value: {\n    id: number\n    type: {\n      def: CodecType<typeof def>\n      path: CodecType<typeof docs>\n      params?: Array<{ name: string; type: number | undefined }>\n    }\n  }) => ({\n    id: value.id,\n    path: value.type.path,\n    params: value.type.params ?? [],\n    def: value.type.def,\n    docs: [],\n  }),\n  (value) => ({\n    id: value.id,\n    type: {\n      def: value.def,\n      path: value.path,\n      params: value.params,\n    },\n  }),\n)\n\nexport const pjsTypes = PjsVector(entry)\nexport type PjsTypes = CodecType<typeof pjsTypes>\n"],"names":[],"mappings":"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"}