{"version":3,"file":"fromShittyHeader.mjs","sources":["../../../src/utils/fromShittyHeader.ts"],"sourcesContent":["import { ShittyHeader } from \"@/types\"\nimport { compact } from \"@polkadot-api/substrate-bindings\"\nimport { fromHex, mergeUint8, toHex } from \"@polkadot-api/utils\"\n\nexport const getFromShittyHeader =\n  (hasher: (input: Uint8Array) => Uint8Array) =>\n  ({\n    parentHash,\n    number: rawNumber,\n    stateRoot,\n    extrinsicsRoot,\n    digest,\n  }: ShittyHeader) => {\n    const number = Number(rawNumber)\n    const rawDigests = digest.logs.map(fromHex)\n\n    const rawHeader = mergeUint8([\n      fromHex(parentHash),\n      compact.enc(number),\n      fromHex(stateRoot),\n      fromHex(extrinsicsRoot),\n      compact.enc(digest.logs.length),\n      ...rawDigests,\n    ])\n\n    return {\n      parent: parentHash,\n      hash: toHex(hasher(rawHeader)),\n      number,\n      hasUpgrade: rawDigests.some(([x]) => x === 8),\n      header: toHex(rawHeader),\n    }\n  }\n"],"names":[],"mappings":";;;AAIO,MAAM,mBAAA,GACX,CAAC,MAAA,KACD,CAAC;AAAA,EACC,UAAA;AAAA,EACA,MAAA,EAAQ,SAAA;AAAA,EACR,SAAA;AAAA,EACA,cAAA;AAAA,EACA;AACF,CAAA,KAAoB;AAClB,EAAA,MAAM,MAAA,GAAS,OAAO,SAAS,CAAA;AAC/B,EAAA,MAAM,UAAA,GAAa,MAAA,CAAO,IAAA,CAAK,GAAA,CAAI,OAAO,CAAA;AAE1C,EAAA,MAAM,YAAY,UAAA,CAAW;AAAA,IAC3B,QAAQ,UAAU,CAAA;AAAA,IAClB,OAAA,CAAQ,IAAI,MAAM,CAAA;AAAA,IAClB,QAAQ,SAAS,CAAA;AAAA,IACjB,QAAQ,cAAc,CAAA;AAAA,IACtB,OAAA,CAAQ,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,MAAM,CAAA;AAAA,IAC9B,GAAG;AAAA,GACJ,CAAA;AAED,EAAA,OAAO;AAAA,IACL,MAAA,EAAQ,UAAA;AAAA,IACR,IAAA,EAAM,KAAA,CAAM,MAAA,CAAO,SAAS,CAAC,CAAA;AAAA,IAC7B,MAAA;AAAA,IACA,UAAA,EAAY,WAAW,IAAA,CAAK,CAAC,CAAC,CAAC,CAAA,KAAM,MAAM,CAAC,CAAA;AAAA,IAC5C,MAAA,EAAQ,MAAM,SAAS;AAAA,GACzB;AACF;;;;"}