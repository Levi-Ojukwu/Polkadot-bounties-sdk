{"version":3,"file":"pjs-signed-extensions-mappers.mjs","sources":["../../src/pjs-signed-extensions-mappers.ts"],"sourcesContent":["import { HexString } from \"@polkadot-api/substrate-bindings\"\nimport {\n  Bytes,\n  Struct,\n  compact,\n  u32,\n  Option,\n  compactBn,\n} from \"@polkadot-api/substrate-bindings\"\nimport { toHex } from \"@polkadot-api/utils\"\n\ntype SignedExtension = {\n  value: Uint8Array\n  additionalSigned: Uint8Array\n}\n\nconst toPjsHex = (value: number | bigint, minByteLen?: number) => {\n  let inner = value.toString(16)\n  inner = (inner.length % 2 ? \"0\" : \"\") + inner\n  const nPaddedBytes = Math.max(0, (minByteLen || 0) - inner.length / 2)\n  return \"0x\" + \"00\".repeat(nPaddedBytes) + inner\n}\n\nexport const CheckGenesis = ({\n  additionalSigned,\n}: SignedExtension): { genesisHash: string } => ({\n  genesisHash: toHex(additionalSigned),\n})\n\nexport const CheckNonce = ({\n  value,\n}: SignedExtension): { nonce: HexString } => {\n  // nonce is a u32 in pjs => 4 bytes\n  return { nonce: toPjsHex(compact.dec(value), 4) }\n}\n\nexport const CheckTxVersion = ({\n  additionalSigned,\n}: SignedExtension): { transactionVersion: HexString } => {\n  return { transactionVersion: toPjsHex(u32.dec(additionalSigned), 4) }\n}\n\nconst assetTxPaymentDec = Struct({\n  tip: compact,\n  asset: Option(Bytes(Infinity)),\n}).dec\n\nexport const ChargeAssetTxPayment = ({\n  value,\n}: SignedExtension): { aseetId?: string; tip?: string } => {\n  const { tip, asset } = assetTxPaymentDec(value)\n\n  return {\n    ...(asset ? { assetId: toHex(asset) } : {}),\n    tip: toPjsHex(tip, 16),\n  }\n}\n\nexport const ChargeTransactionPayment = ({\n  value,\n}: SignedExtension): { tip: HexString } => ({\n  tip: toPjsHex(compactBn.dec(value), 16), // u128 => 16 bytes\n})\n\nexport const CheckMortality = (\n  { value, additionalSigned }: SignedExtension,\n  blockNumber: number,\n): { era: HexString; blockHash: HexString; blockNumber: HexString } => ({\n  era: toHex(value),\n  blockHash: toHex(additionalSigned),\n  blockNumber: toPjsHex(blockNumber, 4),\n})\n\nexport const CheckSpecVersion = ({\n  additionalSigned,\n}: SignedExtension): { specVersion: HexString } => ({\n  specVersion: toPjsHex(u32.dec(additionalSigned), 4),\n})\n\nexport const CheckMetadataHash = ({\n  value,\n  additionalSigned,\n}: SignedExtension): { mode?: number; metadataHash?: HexString } =>\n  value.length && value[0]\n    ? {\n        mode: 1,\n        metadataHash: toHex(\n          additionalSigned.length\n            ? additionalSigned.slice(1)\n            : additionalSigned,\n        ),\n      }\n    : {}\n"],"names":[],"mappings":";;;AAgBA,MAAM,QAAA,GAAW,CAAC,KAAA,EAAwB,UAAA,KAAwB;AAChE,EAAA,IAAI,KAAA,GAAQ,KAAA,CAAM,QAAA,CAAS,EAAE,CAAA;AAC7B,EAAA,KAAA,GAAA,CAAS,KAAA,CAAM,MAAA,GAAS,CAAA,GAAI,GAAA,GAAM,EAAA,IAAM,KAAA;AACxC,EAAA,MAAM,YAAA,GAAe,KAAK,GAAA,CAAI,CAAA,EAAA,CAAI,cAAc,CAAA,IAAK,KAAA,CAAM,SAAS,CAAC,CAAA;AACrE,EAAA,OAAO,IAAA,GAAO,IAAA,CAAK,MAAA,CAAO,YAAY,CAAA,GAAI,KAAA;AAC5C,CAAA;AAEO,MAAM,eAAe,CAAC;AAAA,EAC3B;AACF,CAAA,MAAiD;AAAA,EAC/C,WAAA,EAAa,MAAM,gBAAgB;AACrC,CAAA;AAEO,MAAM,aAAa,CAAC;AAAA,EACzB;AACF,CAAA,KAA6C;AAE3C,EAAA,OAAO,EAAE,OAAO,QAAA,CAAS,OAAA,CAAQ,IAAI,KAAK,CAAA,EAAG,CAAC,CAAA,EAAE;AAClD;AAEO,MAAM,iBAAiB,CAAC;AAAA,EAC7B;AACF,CAAA,KAA0D;AACxD,EAAA,OAAO,EAAE,oBAAoB,QAAA,CAAS,GAAA,CAAI,IAAI,gBAAgB,CAAA,EAAG,CAAC,CAAA,EAAE;AACtE;AAEA,MAAM,oBAAoB,MAAA,CAAO;AAAA,EAC/B,GAAA,EAAK,OAAA;AAAA,EACL,KAAA,EAAO,MAAA,CAAO,KAAA,CAAM,QAAQ,CAAC;AAC/B,CAAC,CAAA,CAAE,GAAA;AAEI,MAAM,uBAAuB,CAAC;AAAA,EACnC;AACF,CAAA,KAA2D;AACzD,EAAA,MAAM,EAAE,GAAA,EAAK,KAAA,EAAM,GAAI,kBAAkB,KAAK,CAAA;AAE9C,EAAA,OAAO;AAAA,IACL,GAAI,QAAQ,EAAE,OAAA,EAAS,MAAM,KAAK,CAAA,KAAM,EAAC;AAAA,IACzC,GAAA,EAAK,QAAA,CAAS,GAAA,EAAK,EAAE;AAAA,GACvB;AACF;AAEO,MAAM,2BAA2B,CAAC;AAAA,EACvC;AACF,CAAA,MAA4C;AAAA,EAC1C,KAAK,QAAA,CAAS,SAAA,CAAU,GAAA,CAAI,KAAK,GAAG,EAAE;AAAA;AACxC,CAAA;AAEO,MAAM,iBAAiB,CAC5B,EAAE,KAAA,EAAO,gBAAA,IACT,WAAA,MACsE;AAAA,EACtE,GAAA,EAAK,MAAM,KAAK,CAAA;AAAA,EAChB,SAAA,EAAW,MAAM,gBAAgB,CAAA;AAAA,EACjC,WAAA,EAAa,QAAA,CAAS,WAAA,EAAa,CAAC;AACtC,CAAA;AAEO,MAAM,mBAAmB,CAAC;AAAA,EAC/B;AACF,CAAA,MAAoD;AAAA,EAClD,aAAa,QAAA,CAAS,GAAA,CAAI,GAAA,CAAI,gBAAgB,GAAG,CAAC;AACpD,CAAA;AAEO,MAAM,oBAAoB,CAAC;AAAA,EAChC,KAAA;AAAA,EACA;AACF,CAAA,KACE,KAAA,CAAM,MAAA,IAAU,KAAA,CAAM,CAAC,CAAA,GACnB;AAAA,EACE,IAAA,EAAM,CAAA;AAAA,EACN,YAAA,EAAc,KAAA;AAAA,IACZ,gBAAA,CAAiB,MAAA,GACb,gBAAA,CAAiB,KAAA,CAAM,CAAC,CAAA,GACxB;AAAA;AAER,CAAA,GACA;;;;"}