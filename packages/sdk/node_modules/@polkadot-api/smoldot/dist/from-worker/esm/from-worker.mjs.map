{"version":3,"file":"from-worker.mjs","sources":["../../../src/from-worker.ts"],"sourcesContent":["import type { Client } from \"smoldot\"\nimport {\n  type SmoldotBytecode,\n  type ClientOptionsWithBytecode,\n  startWithBytecode,\n} from \"smoldot/no-auto-bytecode\"\n\nexport type SmoldotOptions = Omit<\n  ClientOptionsWithBytecode,\n  \"bytecode\" | \"portToWorker\"\n>\n\nexport const startFromWorker = (\n  worker: Worker,\n  options: SmoldotOptions = {},\n): Client => {\n  const bytecode = new Promise<SmoldotBytecode>((resolve) => {\n    worker.onmessage = (event) => resolve(event.data)\n  })\n\n  const { port1, port2 } = new MessageChannel()\n  worker.postMessage(port1, [port1])\n\n  return startWithBytecode({\n    bytecode,\n    portToWorker: port2,\n    ...options,\n  })\n}\n"],"names":[],"mappings":";;AAYO,MAAM,eAAA,GAAkB,CAC7B,MAAA,EACA,OAAA,GAA0B,EAAC,KAChB;AACX,EAAA,MAAM,QAAA,GAAW,IAAI,OAAA,CAAyB,CAAC,OAAA,KAAY;AACzD,IAAA,MAAA,CAAO,SAAA,GAAY,CAAC,KAAA,KAAU,OAAA,CAAQ,MAAM,IAAI,CAAA;AAAA,EAClD,CAAC,CAAA;AAED,EAAA,MAAM,EAAE,KAAA,EAAO,KAAA,EAAM,GAAI,IAAI,cAAA,EAAe;AAC5C,EAAA,MAAA,CAAO,WAAA,CAAY,KAAA,EAAO,CAAC,KAAK,CAAC,CAAA;AAEjC,EAAA,OAAO,iBAAA,CAAkB;AAAA,IACvB,QAAA;AAAA,IACA,YAAA,EAAc,KAAA;AAAA,IACd,GAAG;AAAA,GACJ,CAAA;AACH;;;;"}