{"version":3,"file":"get-raw-metadta.mjs","sources":["../../../src/utils/get-raw-metadta.ts"],"sourcesContent":["import { Bytes, Option, u32, Vector } from \"@polkadot-api/substrate-bindings\"\nimport { toHex } from \"@polkadot-api/utils\"\nimport { catchError, map, mergeMap, Observable, of } from \"rxjs\"\n\nconst versionedArgs = (v: number) => toHex(u32.enc(v))\nconst opaqueBytes = Bytes()\nconst optionalOpaqueBytes = Option(opaqueBytes)\nconst u32ListDecoder = Vector(u32).dec\n\nexport const getRawMetadata$ = (\n  call$: (method: string, args: string) => Observable<string>,\n): Observable<Uint8Array> => {\n  const versions$ = call$(\"Metadata_metadata_versions\", \"\").pipe(\n    map(u32ListDecoder),\n    catchError(() => of([14])),\n  )\n\n  const versioned$ = (availableVersions: number[]) => {\n    const [v] = availableVersions\n      .filter((x) => x > 13 && x < 17)\n      .sort((a, b) => b - a)\n    return v === 14\n      ? call$(\"Metadata_metadata\", \"\").pipe(map(opaqueBytes.dec))\n      : call$(\"Metadata_metadata_at_version\", versionedArgs(v)).pipe(\n          map((x) => optionalOpaqueBytes.dec(x)!),\n        )\n  }\n\n  return versions$.pipe(mergeMap(versioned$))\n}\n"],"names":[],"mappings":";;;;AAIA,MAAM,gBAAgB,CAAC,CAAA,KAAc,MAAM,GAAA,CAAI,GAAA,CAAI,CAAC,CAAC,CAAA;AACrD,MAAM,cAAc,KAAA,EAAM;AAC1B,MAAM,mBAAA,GAAsB,OAAO,WAAW,CAAA;AAC9C,MAAM,cAAA,GAAiB,MAAA,CAAO,GAAG,CAAA,CAAE,GAAA;AAE5B,MAAM,eAAA,GAAkB,CAC7B,KAAA,KAC2B;AAC3B,EAAA,MAAM,SAAA,GAAY,KAAA,CAAM,4BAAA,EAA8B,EAAE,CAAA,CAAE,IAAA;AAAA,IACxD,IAAI,cAAc,CAAA;AAAA,IAClB,WAAW,MAAM,EAAA,CAAG,CAAC,EAAE,CAAC,CAAC;AAAA,GAC3B;AAEA,EAAA,MAAM,UAAA,GAAa,CAAC,iBAAA,KAAgC;AAClD,IAAA,MAAM,CAAC,CAAC,CAAA,GAAI,iBAAA,CACT,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,GAAI,EAAA,IAAM,CAAA,GAAI,EAAE,CAAA,CAC9B,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAM,IAAI,CAAC,CAAA;AACvB,IAAA,OAAO,MAAM,EAAA,GACT,KAAA,CAAM,mBAAA,EAAqB,EAAE,EAAE,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,GAAG,CAAC,CAAA,GACxD,KAAA,CAAM,gCAAgC,aAAA,CAAc,CAAC,CAAC,CAAA,CAAE,IAAA;AAAA,MACtD,IAAI,CAAC,CAAA,KAAM,mBAAA,CAAoB,GAAA,CAAI,CAAC,CAAE;AAAA,KACxC;AAAA,EACN,CAAA;AAEA,EAAA,OAAO,SAAA,CAAU,IAAA,CAAK,QAAA,CAAS,UAAU,CAAC,CAAA;AAC5C;;;;"}