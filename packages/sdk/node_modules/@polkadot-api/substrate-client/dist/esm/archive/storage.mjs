import { abortablePromiseFn } from '../internal-utils/abortablePromiseFn.mjs';

const createStorageFn = (cbStore) => abortablePromiseFn((resolve, reject, hash, type, key, childTrie) => {
  const isDescendants = type.startsWith("descendants");
  let result = isDescendants ? [] : null;
  const onItem = isDescendants ? result.push.bind(result) : ({ [type]: res }) => {
    result = res;
  };
  return cbStore(
    hash,
    [{ key, type }],
    childTrie,
    onItem,
    (e) => {
      reject(e);
      result = null;
    },
    () => {
      resolve(result);
      result = null;
    }
  );
});

export { createStorageFn };
//# sourceMappingURL=storage.mjs.map
