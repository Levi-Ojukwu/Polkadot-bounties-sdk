{"version":3,"file":"index.js","sources":["../src/parsed.ts","../src/methods.ts","../src/parsed-enhancers/chain-spec.ts","../src/parsed-enhancers/fix-premature-blocks.ts","../src/utils.ts","../src/parsed-enhancers/fix-descendant-values.ts","../src/parsed-enhancers/fix-unordered-blocks.ts","../src/parsed-enhancers/fix-unordered-events.ts","../src/parsed-enhancers/patch-chainhead-events.ts","../src/parsed-enhancers/unpin-hash.ts","../src/parsed-enhancers/translate.ts","../src/parsed-enhancers/numeric-ids.ts","../src/index.ts"],"sourcesContent":["import { JsonRpcProvider } from \"@polkadot-api/json-rpc-provider\"\n\nexport interface ParsedJsonRpcConnection {\n  send: <T extends {}>(message: T) => void\n  disconnect: () => void\n}\n\nexport type ParsedJsonRpcProvider = (\n  onMesage: <T extends {}>(message: T) => void,\n) => ParsedJsonRpcConnection\n\nexport type ParsedJsonRpcEnhancer = (\n  base: ParsedJsonRpcProvider,\n) => ParsedJsonRpcProvider\n\nexport const toParsed = (base: JsonRpcProvider): ParsedJsonRpcProvider => {\n  let _onMsg: null | (<T extends {}>(msg: T) => void) = null\n  const { send, disconnect } = base((msg) => {\n    _onMsg?.(JSON.parse(msg))\n  })\n\n  return (onMsg) => {\n    _onMsg = onMsg\n    return {\n      send(msg) {\n        send(JSON.stringify(msg))\n      },\n      disconnect() {\n        _onMsg = null\n        disconnect()\n      },\n    }\n  }\n}\n\nexport const fromParsed = (base: ParsedJsonRpcProvider): JsonRpcProvider => {\n  let _onMsg: null | ((msg: string) => void) = null\n  const { send, disconnect } = base((msg) => {\n    _onMsg?.(JSON.stringify(msg))\n  })\n\n  return (onMsg) => {\n    _onMsg = onMsg\n    return {\n      send(msg) {\n        send(JSON.parse(msg))\n      },\n      disconnect() {\n        _onMsg = null\n        disconnect()\n      },\n    }\n  }\n}\n\nexport const parsed =\n  (\n    ...enhancers: Array<ParsedJsonRpcEnhancer>\n  ): ((base: JsonRpcProvider) => JsonRpcProvider) =>\n  (base) =>\n    fromParsed(enhancers.reduce((a, b) => b(a), toParsed(base)))\n","const chainHead = {\n  body: \"\",\n  call: \"\",\n  continue: \"\",\n  follow: \"\",\n  header: \"\",\n  stopOperation: \"\",\n  storage: \"\",\n  unfollow: \"\",\n  unpin: \"\",\n}\n\nconst transaction = {\n  broadcast: \"\",\n  stop: \"\",\n}\n\nconst chainSpec = {\n  chainName: \"\",\n  genesisHash: \"\",\n  properties: \"\",\n}\n\nObject.entries({ chainHead, chainSpec, transaction }).forEach(\n  ([fnGroupName, methods]) => {\n    Object.keys(methods).forEach((methodName) => {\n      ;(methods as any)[methodName] = `${fnGroupName}_v1_${methodName}`\n    })\n  },\n)\n\nexport { chainHead, transaction, chainSpec }\n","import type { ParsedJsonRpcEnhancer } from \"@/parsed\"\nimport { chainSpec } from \"@/methods\"\n\nexport const fixChainSpec: ParsedJsonRpcEnhancer = (base) => (onMsg) => {\n  const { send: originalSend, disconnect } = base(onMsg)\n\n  const send = (msg: any) => {\n    switch (msg.method) {\n      case chainSpec.chainName:\n        return originalSend({ ...msg, method: \"system_chain\" })\n      case chainSpec.genesisHash:\n        return originalSend({\n          ...msg,\n          method: \"chain_getBlockHash\",\n          params: [0],\n        })\n      case chainSpec.properties:\n        return originalSend({ ...msg, method: \"system_properties\" })\n    }\n    originalSend(msg)\n  }\n\n  return {\n    send,\n    disconnect,\n  }\n}\n","import { chainHead } from \"@/methods\"\nimport type { ParsedJsonRpcEnhancer } from \"@/parsed\"\n\ninterface InitializedRpc {\n  event: \"initialized\"\n  finalizedBlockHashes: string[]\n}\n\ninterface NewBlockRpc {\n  event: \"newBlock\"\n  blockHash: string\n  parentBlockHash: string\n}\n\ninterface BestBlockChangedRpc {\n  event: \"bestBlockChanged\"\n  bestBlockHash: string\n}\n\ninterface FinalizedRpc {\n  event: \"finalized\"\n  finalizedBlockHashes: Array<string>\n  prunedBlockHashes: Array<string>\n}\n\nexport interface StopRpc {\n  event: \"stop\"\n}\n\ntype FollowEvent =\n  | InitializedRpc\n  | NewBlockRpc\n  | BestBlockChangedRpc\n  | FinalizedRpc\n  | StopRpc\n\nexport const fixPrematureBlocks: ParsedJsonRpcEnhancer = (base) => (onMsg) => {\n  const pendingChainHeadSubs = new Set<string>()\n  const pinnedBlocksInSub = new Map<string, Set<string>>()\n  const prematureBlocks = new Map<string, Map<string, Array<{}>>>()\n\n  const { send: originalSend, disconnect } = base((message) => {\n    // it's a response\n    if (\"id\" in message) {\n      onMsg(message)\n      const { id, result } = message as unknown as {\n        id: string\n        result: string\n      }\n\n      if (pendingChainHeadSubs.has(id)) {\n        pendingChainHeadSubs.delete(id)\n        pinnedBlocksInSub.set(result, new Set())\n        prematureBlocks.set(result, new Map())\n        return\n      }\n    } else {\n      // it's a notification\n      const { subscription } = (message as any).params\n      const pinnedBlocks = pinnedBlocksInSub.get(subscription)\n      const prematureSub = prematureBlocks.get(subscription)!\n      if (pinnedBlocks) {\n        const result = (message as any).params.result as FollowEvent\n        const { event } = result\n        if (event === \"initialized\") {\n          result.finalizedBlockHashes.forEach((hash) => {\n            pinnedBlocks.add(hash)\n          })\n        }\n\n        if (event === \"newBlock\") {\n          const { parentBlockHash } = result\n          if (!pinnedBlocks.has(parentBlockHash)) {\n            const list = prematureSub.get(parentBlockHash) ?? []\n            list.push(message)\n            prematureSub.set(parentBlockHash, list)\n            return\n          }\n\n          const hash = result.blockHash\n          pinnedBlocks.add(result.blockHash)\n          onMsg(message)\n\n          const prematureMessages = prematureSub.get(hash)\n          if (prematureMessages) {\n            prematureSub.delete(hash)\n            prematureMessages.forEach((msg) => {\n              pinnedBlocks.add((msg as any).params.result.blockHash)\n              onMsg(msg)\n            })\n          }\n          return\n        }\n\n        if (event === \"stop\") {\n          pinnedBlocks.delete(subscription)\n          prematureBlocks.delete(subscription)\n        }\n      }\n      onMsg(message)\n    }\n  })\n\n  const send = (msg: any) => {\n    const subId = msg.params[0]\n    switch (msg.method) {\n      case chainHead.follow:\n        pendingChainHeadSubs.add(msg.id)\n        break\n\n      case chainHead.unpin:\n        const [subscription, blocks] = msg.params as [string, string[]]\n        blocks.forEach((block) => {\n          pinnedBlocksInSub.get(subscription)?.delete(block)\n          prematureBlocks.get(subscription)?.delete(block)\n        })\n        break\n\n      case chainHead.unfollow:\n        pinnedBlocksInSub.delete(subId)\n        prematureBlocks.delete(subId)\n        break\n    }\n    originalSend(msg)\n  }\n\n  return {\n    send,\n    disconnect,\n  }\n}\n","import { ParsedJsonRpcProvider } from \"./parsed\"\n\nexport const jsonObj = <T extends {}>(input: T) => ({\n  jsonrpc: \"2.0\",\n  ...input,\n})\nexport const operationNotification = <T extends {}>(\n  subscription: string,\n  event: string,\n  operationId: string,\n  innerResult: T = {} as T,\n) =>\n  jsonObj({\n    method: \"chainHead_v1_followEvent\",\n    params: {\n      subscription,\n      result: {\n        event,\n        operationId,\n        ...innerResult,\n      },\n    },\n  })\n\nconst requestPrefix = \"__INNER_RQ_DesV\"\nexport const getRequest = (base: ParsedJsonRpcProvider) => {\n  let nextId = 0\n  const onGoingRequests = new Map<string, (ok: boolean, x: any) => void>()\n\n  const listener: <T extends { id: string; result: T; error?: any }>(\n    msg: T,\n  ) => boolean = ({ id, error, result }) => {\n    const callback = onGoingRequests.get(id)\n    if (callback) {\n      onGoingRequests.delete(id)\n      if (error) callback(false, error)\n      else callback(true, result)\n    }\n    return !callback\n  }\n\n  let send: <T extends {}>(msg: T) => void = () => {}\n  const provider: ParsedJsonRpcProvider = (onMsg) => {\n    const { send: _send, disconnect } = base((msg) => {\n      if (listener(msg as any)) onMsg(msg)\n    })\n    send = _send\n    return {\n      send,\n      disconnect: () => {\n        onGoingRequests.clear()\n        disconnect()\n      },\n    }\n  }\n\n  const request = <T>(\n    method: string,\n    params: Array<any>,\n    onSuccess: (x: T) => void,\n    onError: (e: any) => void,\n  ): void => {\n    const id = requestPrefix + nextId++\n    onGoingRequests.set(id, (isOk, value) => {\n      ;(isOk ? onSuccess : onError)(value)\n    })\n    send(jsonObj({ id, method, params }))\n  }\n\n  return [provider, request] as const\n}\n","import { chainHead } from \"@/methods\"\nimport type { ParsedJsonRpcEnhancer } from \"@/parsed\"\nimport { getRequest, jsonObj, operationNotification } from \"@/utils\"\n\nconst operationPrefix = \"__INNER_OP_DesV\"\nlet nextOperationId = 0\nexport const fixDescendantValues: ParsedJsonRpcEnhancer = (base) => (onMsg) => {\n  const [provider, request] = getRequest(base)\n  const getDescendantValues = getDescendantValuesFromOldRpc(request)\n\n  // the `id` of the json-rpc request that should respond with the `operationId`\n  // if it has started, the value is the callback-function that is waiting for the `operationId`\n  const preOpId = new Map<string, (operationId: string) => void>()\n\n  // chainHeadSubscription - operationId => operationState\n  const onGoing: Map<\n    string,\n    Map<\n      string,\n      {\n        isOutterDone: boolean\n        isInnerDone: boolean\n        cancel: () => void\n      }\n    >\n  > = new Map()\n\n  const { send: originalSend, disconnect } = provider((msg: any) => {\n    // it's a response\n    if (\"id\" in msg) {\n      const opIdCb = preOpId.get(msg.id)\n      if (opIdCb) {\n        preOpId.delete(msg.id)\n        if (msg.result.result === \"started\") opIdCb(msg.result.operationId)\n      }\n    } else if (msg.params) {\n      // it's a notifiaction\n      const { subscription, result } = (msg as any).params\n      const { operationId } = result || {}\n      const operations = onGoing.get(subscription)\n\n      if (operations && result.event === \"stop\") {\n        operations.forEach((x) => {\n          x.cancel()\n        })\n        onGoing.delete(subscription)\n      }\n\n      const operation = operations?.get(operationId)\n      if (operation) {\n        switch (result.event) {\n          case \"operationInaccessible\":\n          case \"operationError\":\n            operation.cancel()\n            break\n          case \"operationStorageDone\": {\n            if (operation.isInnerDone) {\n              operations!.delete(operationId)\n            } else {\n              operation.isOutterDone = true\n              return\n            }\n          }\n        }\n      }\n    }\n    onMsg(msg)\n  })\n\n  const getStartDescendantValues =\n    (subscription: string, blockHash: string, keys: string[]) =>\n    (operationId: string) => {\n      let _cancel = () => {}\n      if (!onGoing.has(subscription)) {\n        onGoing.set(subscription, new Map())\n      }\n      const operationsMap = onGoing.get(subscription)!\n      const state = {\n        isOutterDone: false,\n        isInnerDone: false,\n        cancel: () => {\n          _cancel()\n        },\n      }\n      operationsMap.set(operationId, state)\n\n      let nFinished = 0\n      const stoppers = keys.map((key) =>\n        getDescendantValues(\n          key,\n          blockHash,\n          (values) => {\n            onMsg(\n              operationNotification(\n                subscription,\n                \"operationStorageItems\",\n                operationId,\n                { items: values.map(([key, value]) => ({ key, value })) },\n              ),\n            )\n          },\n          (error) => {\n            _cancel()\n            if (!state.isOutterDone) {\n              // stop the outer\n              originalSend(\n                jsonObj({\n                  method: \"chainHead_v1_stopOperation\",\n                  params: [operationId],\n                }),\n              )\n            }\n            // send error\n            onMsg(\n              operationNotification(\n                subscription,\n                \"operationError\",\n                operationId,\n                {\n                  error:\n                    typeof error === \"string\" ? error : JSON.stringify(error),\n                },\n              ),\n            )\n          },\n          () => {\n            if (++nFinished === keys.length) {\n              if (state.isOutterDone) {\n                // done\n                _cancel()\n                onMsg(\n                  operationNotification(\n                    subscription,\n                    \"operationStorageDone\",\n                    operationId,\n                  ),\n                )\n              } else state.isInnerDone = true\n            }\n          },\n        ),\n      )\n      _cancel = () => {\n        operationsMap.delete(operationId)\n        stoppers.forEach((cb) => cb())\n      }\n    }\n\n  const send = (msg: any) => {\n    switch (msg.method) {\n      case chainHead.storage: {\n        const [followSub, blockHash, items] = msg.params as [\n          string,\n          string,\n          any[],\n        ]\n        const descendantsValuesKeys: string[] = []\n        const actualItems = items.filter((x) => {\n          const isDescendantsValues = x.type === \"descendantsValues\"\n          if (isDescendantsValues) descendantsValuesKeys.push(x.key)\n          return !isDescendantsValues\n        })\n\n        const startGetDescendantValues = getStartDescendantValues(\n          followSub,\n          blockHash,\n          descendantsValuesKeys,\n        )\n        if (!actualItems.length) {\n          const operationId = operationPrefix + nextOperationId++\n          onMsg(\n            jsonObj({\n              id: msg.id,\n              result: { result: \"started\", operationId },\n            }),\n          )\n          startGetDescendantValues(operationId)\n          onGoing.get(followSub)!.get(operationId)!.isOutterDone = true\n          return\n        } else if (descendantsValuesKeys.length) {\n          preOpId.set(msg.id, startGetDescendantValues)\n        }\n        msg.params[2] = actualItems\n        break\n      }\n      case chainHead.stopOperation: {\n        const [followSubscription, operationId] = msg.params as [string, string]\n        const data = onGoing.get(followSubscription)?.get(operationId)\n        if (data) {\n          data.cancel()\n          if (data.isOutterDone) return\n        }\n        break\n      }\n      case chainHead.unfollow: {\n        const [followSubscription] = msg.params as [string]\n        onGoing.get(followSubscription)?.forEach((x) => x.cancel())\n        onGoing.delete(followSubscription)\n        break\n      }\n    }\n    originalSend(msg)\n  }\n\n  return {\n    send,\n    disconnect,\n  }\n}\n\n/**\n * A higher-order function that returns a process to fetch descendant values\n * from the storage of block using an older RPC method.\n *\n * This function takes a `request` function as an argument, which is used to\n * make RPC calls. The returned function accepts a storage key (`rootKey`) and a\n * block hash (`at`) as inputs, as well as three callbacks:\n * 1. `onValues`: triggered when new values are retrieved.\n * 2. `onError`: triggered in case of an error during the operation.\n * 3. `onDone`: triggered when all values have been successfully fetched.\n *\n * The operation works by paginating through storage keys using\n * `state_getKeysPaged`\n * and fetching the corresponding values using `state_queryStorageAt`.\n * It runs in the background and supports stopping the operation early by\n * returning a callback function that, when invoked, cancels further processing.\n *\n * The flow of execution:\n * - The function continuously fetches storage keys in batches.\n * - For each batch, it fetches the descendant values at the specified block\n * hash.\n * - If an error occurs or the user cancels the operation, it stops fetching.\n * - The `onDone` callback is triggered when all the keys have been processed\n * and all ongoing value retrieval operations are completed.\n */\nconst getDescendantValuesFromOldRpc =\n  (\n    request: <T>(\n      method: string,\n      args: Array<any>,\n      onSuccess: (value: T) => void,\n      onError: (e: any) => void,\n    ) => void,\n  ) =>\n  (\n    rootKey: string,\n    at: string,\n    onValues: (input: Array<[string, string]>) => void,\n    onError: (e: any) => void,\n    onDone: () => void,\n  ): (() => void) => {\n    let isRunning = true\n    let areAllKeysDone = false\n    let onGoingValues = 0\n\n    const _onError = (e: any) => {\n      if (isRunning) {\n        isRunning = false\n        onError(e)\n      }\n    }\n\n    const PAGE_SIZE = 1000\n    const pullKeys = (startAtKey?: string) => {\n      request<string[]>(\n        \"state_getKeysPaged\",\n        [rootKey, PAGE_SIZE, startAtKey || undefined, at],\n        (result) => {\n          if (isRunning) {\n            if (result.length > 0) {\n              onGoingValues++\n              request<[{ block: string; changes: Array<[string, string]> }]>(\n                \"state_queryStorageAt\",\n                [result, at],\n                ([{ changes }]) => {\n                  if (isRunning) {\n                    onGoingValues--\n                    onValues(changes)\n                    if (areAllKeysDone && !onGoingValues) onDone()\n                  }\n                },\n                _onError,\n              )\n            }\n            if (result.length < PAGE_SIZE) {\n              areAllKeysDone = true\n              if (!onGoingValues) onDone()\n            } else pullKeys(result.at(-1))\n          }\n        },\n        _onError,\n      )\n    }\n    pullKeys()\n\n    return () => {\n      isRunning = false\n    }\n  }\n","import type { ParsedJsonRpcEnhancer } from \"@/parsed\"\nimport { chainHead } from \"@/methods\"\n\ninterface InitializedRpc {\n  event: \"initialized\"\n  finalizedBlockHashes: string[]\n}\n\ninterface NewBlockRpc {\n  event: \"newBlock\"\n  blockHash: string\n  parentBlockHash: string\n}\n\ninterface BestBlockChangedRpc {\n  event: \"bestBlockChanged\"\n  bestBlockHash: string\n}\n\ninterface FinalizedRpc {\n  event: \"finalized\"\n  finalizedBlockHashes: Array<string>\n  prunedBlockHashes: Array<string>\n}\n\nexport interface StopRpc {\n  event: \"stop\"\n}\n\ntype FollowEvent =\n  | InitializedRpc\n  | NewBlockRpc\n  | BestBlockChangedRpc\n  | FinalizedRpc\n  | StopRpc\n\nexport const fixUnorderedBlocks: ParsedJsonRpcEnhancer = (base) => (onMsg) => {\n  const pendingChainHeadSubs = new Set<string>()\n  const pinnedBlocksInSub = new Map<string, Set<string>>()\n  const uknownBlocksNotifications = new Map<string, Map<string, any>>()\n\n  const { send: originalSend, disconnect } = base((message) => {\n    // it's a response\n    if (\"id\" in message) {\n      onMsg(message)\n      const { id, result } = message as unknown as {\n        id: string\n        result: string\n      }\n\n      if (pendingChainHeadSubs.has(id)) {\n        pendingChainHeadSubs.delete(id)\n        pinnedBlocksInSub.set(result, new Set())\n        uknownBlocksNotifications.set(result, new Map())\n        return\n      }\n    } else {\n      // it's a notification\n      const { subscription } = (message as any).params\n      const pinnedBlocks = pinnedBlocksInSub.get(subscription)\n      const premature = uknownBlocksNotifications.get(subscription)!\n      if (pinnedBlocks) {\n        const result = (message as any).params.result as FollowEvent\n        const { event } = result\n        if (event === \"initialized\") {\n          result.finalizedBlockHashes.forEach((hash) => {\n            pinnedBlocks.add(hash)\n          })\n        }\n\n        if (event === \"finalized\") {\n          result.prunedBlockHashes = result.prunedBlockHashes.filter((x) =>\n            pinnedBlocks.has(x),\n          )\n        }\n\n        if (event === \"newBlock\") {\n          pinnedBlocks.add(result.blockHash)\n          const hash = result.blockHash\n          const missing = premature.get(hash)\n          if (missing) {\n            premature.delete(hash)\n            onMsg(message)\n            Promise.resolve().then(() => {\n              onMsg(missing)\n            })\n            return\n          }\n        }\n\n        if (event === \"bestBlockChanged\") {\n          const hash = result.bestBlockHash\n          if (!pinnedBlocks.has(hash)) {\n            uknownBlocksNotifications.get(subscription)!.set(hash, message)\n            return\n          }\n        }\n\n        if (event === \"stop\") {\n          pinnedBlocks.delete(subscription)\n          uknownBlocksNotifications.delete(subscription)\n        }\n      }\n      onMsg(message)\n    }\n  })\n\n  const send = (msg: any) => {\n    const subId = msg.params[0]\n    switch (msg.method) {\n      case chainHead.follow:\n        pendingChainHeadSubs.add(msg.id)\n        break\n\n      case chainHead.unpin:\n        const [subscription, blocks] = msg.params as [string, string[]]\n        blocks.forEach((block) => {\n          pinnedBlocksInSub.get(subscription)?.delete(block)\n          uknownBlocksNotifications.get(subscription)?.delete(block)\n        })\n        break\n\n      case chainHead.unfollow:\n        pinnedBlocksInSub.delete(subId)\n        uknownBlocksNotifications.delete(subId)\n        break\n    }\n    originalSend(msg)\n  }\n\n  return {\n    send,\n    disconnect,\n  }\n}\n","import type { ParsedJsonRpcEnhancer } from \"@/parsed\"\nimport { chainHead } from \"@/methods\"\n\nconst terminalOperationEvents = new Set(\n  [\"BodyDone\", \"CallDone\", \"StorageDone\", \"Inaccessible\", \"Error\"].map(\n    (x) => \"operation\" + x,\n  ),\n)\nconst isTerminalNotification = (msg: any): boolean =>\n  terminalOperationEvents.has(msg.params?.result?.event)\n\nexport const fixUnorderedEvents: ParsedJsonRpcEnhancer = (base) => (onMsg) => {\n  const pendingChainHeadSubs = new Set<string>()\n  const pendingOperationIds: Map<string, string> = new Map()\n\n  const activeOperationIds = new Map<string, Set<string>>()\n  const uknownOperationNotifications = new Map<\n    string,\n    Map<string, Array<any>>\n  >()\n\n  const { send: originalSend, disconnect } = base((message) => {\n    // it's a response\n    if (\"id\" in message) {\n      onMsg(message)\n      const { id, result } = message as unknown as {\n        id: string\n        result: string\n      }\n      if (pendingChainHeadSubs.has(id)) {\n        pendingChainHeadSubs.delete(id)\n        activeOperationIds.set(result, new Set())\n        uknownOperationNotifications.set(result, new Map())\n        return\n      }\n\n      const subId = pendingOperationIds.get(id)\n      if (subId !== undefined) {\n        pendingOperationIds.delete(id)\n        const opId = (message as any).result?.operationId\n        // it's possible that the limit has been reached... so we need to check\n        // it's also possible that the response came after an unfollow\n        if (opId !== undefined && activeOperationIds.has(subId)) {\n          const subOperations = activeOperationIds.get(subId)!\n          subOperations.add(opId)\n          const pendingNotifications = uknownOperationNotifications\n            .get(subId)\n            ?.get(opId)\n\n          if (pendingNotifications) {\n            pendingNotifications.forEach(onMsg)\n            uknownOperationNotifications.get(subId)!.delete(opId)\n            if (isTerminalNotification(pendingNotifications.at(-1)))\n              subOperations.delete(opId)\n          }\n        }\n      }\n    } else {\n      // it's a notification\n      const { subscription, result } = (message as any).params\n      const operationIds = activeOperationIds.get(subscription)\n      if (operationIds) {\n        const { operationId } = (message as any).params.result\n        if (operationId !== undefined) {\n          if (!operationIds.has(operationId)) {\n            // The operationId hasn't arrived yet\n            const subscriptionPending =\n              uknownOperationNotifications.get(subscription)!\n            const pendingMessages = subscriptionPending.get(operationId) ?? []\n            pendingMessages.push(message)\n            subscriptionPending.set(operationId, pendingMessages)\n            return\n          } else if (isTerminalNotification(message))\n            operationIds.delete(operationId)\n        } else if (result?.event === \"stop\") {\n          activeOperationIds.delete(subscription)\n          uknownOperationNotifications.delete(subscription)\n        }\n      }\n      onMsg(message)\n    }\n  })\n\n  const send = (msg: any) => {\n    const subId = msg.params[0]\n    switch (msg.method) {\n      case chainHead.follow:\n        pendingChainHeadSubs.add(msg.id)\n        break\n\n      case chainHead.body:\n      case chainHead.call:\n      case chainHead.storage:\n        pendingOperationIds.set(msg.id, subId)\n        break\n\n      case chainHead.unfollow:\n        activeOperationIds.delete(subId)\n        uknownOperationNotifications.delete(subId)\n        break\n\n      case chainHead.stopOperation:\n        activeOperationIds.get(subId)?.delete(msg.params[1])\n    }\n    originalSend(msg)\n  }\n\n  return {\n    send,\n    disconnect,\n  }\n}\n","import type { ParsedJsonRpcEnhancer } from \"@/parsed\"\n\nexport const patchChainHeadEvents: ParsedJsonRpcEnhancer = (base) => (onMsg) =>\n  base((message) => {\n    const result = (message as any).params?.result\n    if (!(\"id\" in message) && result) {\n      const { prunedBlockHashes, finalizedBlockHash, event } = result\n      if (event === \"finalized\" && Array.isArray(prunedBlockHashes))\n        result.prunedBlockHashes = [...new Set(result.prunedBlockHashes)]\n      else if (event === \"initialized\" && finalizedBlockHash) {\n        result.finalizedBlockHashes = [result.finalizedBlockHash]\n        delete result.finalizedBlockHash\n      }\n    }\n    onMsg(message)\n  })\n","import { chainHead } from \"@/methods\"\nimport type { ParsedJsonRpcEnhancer } from \"@/parsed\"\n\nexport const unpinHash: ParsedJsonRpcEnhancer = (base) => (onMsg) => {\n  const { send: _send, disconnect } = base(onMsg)\n\n  const send = (msg: { id?: string; method?: string; params?: Array<any> }) => {\n    const { method, params, id, ...rest } = msg\n    if (method == chainHead.unpin && params && Array.isArray(params[1])) {\n      params[1].forEach((hash, idx) => {\n        _send({\n          ...rest,\n          id: idx === 0 ? id : `${id}-patched-${idx}`,\n          method,\n          params: [params[0], hash],\n        })\n      })\n    } else _send(msg)\n  }\n\n  return { send, disconnect }\n}\n","import { chainHead, chainSpec, transaction } from \"@/methods\"\nimport { ParsedJsonRpcEnhancer } from \"@/parsed\"\n\nconst jsonRpcMsg = <T extends {}>(msg: T) => ({\n  jsonrpc: \"2.0\",\n  ...msg,\n})\n\nconst [transactionGroup] = transaction.stop.split(\"_\")\nconst unstable = \"unstable\"\nconst rpcMethods = \"rpc_methods\"\nconst RPC_METHODS_ID = \"__INTERNAL_ID\"\n\nexport const translate: ParsedJsonRpcEnhancer = (base) => {\n  return (originalOnMsg) => {\n    let isRunning = true\n    let bufferedMsgs: Array<{ id: string; method: string; params: string }> = []\n\n    // It's possible (and very likely) that the consumer will start sending requests\n    // before we have figured out which are the actual methods that are available and\n    // how to translate them. So, the initial `_send` function just captures those received\n    // requests until it's able to \"translate\" them... At which point it will send all\n    // the buffered messages and then it will mutate the _send function with the one\n    // that it's able to transalte the requests\n    let _send = (msg: any) => {\n      bufferedMsgs.push(msg)\n    }\n\n    // originally the _onMsg function is wired up to receive the initial response to\n    // our internal rpc_methods request. Once it receives the response, then it applies\n    // the necessary transaltions and re-wires the _onMsg to the original one.\n    const preOnMsg: (msg: any) => void = ({\n      id,\n      result,\n      error,\n    }: {\n      id: string\n      result: { methods: string[] } | undefined\n      error: any\n    }) => {\n      if (id !== RPC_METHODS_ID || !isRunning) return\n\n      // it's an error, let's try again\n      if (!result) {\n        console.error(error)\n        if (nTries < 4) {\n          setTimeout(sendMethodsRequest, 200)\n          return\n        }\n        // simplest way to propagate the error\n        result = { methods: [] }\n      }\n\n      const methodsSet = new Set(result.methods)\n      const methodMappings: Record<string, string | null> = {}\n\n      ;[chainHead, chainSpec, transaction].forEach((obj) => {\n        Object.values(obj).forEach((method) => {\n          if (methodsSet.has(method)) {\n            methodMappings[method] = method\n          } else {\n            const [group, , name] = method.split(\"_\")\n            const unstableMethod = `${group}_${unstable}_${name}`\n\n            if (methodsSet.has(unstableMethod)) {\n              methodMappings[method] = unstableMethod\n              methodsSet.delete(unstableMethod)\n              methodsSet.add(method)\n            } else {\n              methodMappings[method] = null\n              if (group === transactionGroup) {\n                let matchedMethod: string\n                const translatedMethod =\n                  method === \"stop\" ? \"unwatch\" : \"submitAndWatch\"\n                const txGroup = [\n                  transactionGroup + \"Watch\",\n                  transactionGroup,\n                ].find((group) =>\n                  [\"v1\", unstable].find((v) =>\n                    methodsSet.has(\n                      (matchedMethod = `${group}_${v}_${translatedMethod}`),\n                    ),\n                  ),\n                )\n                if (txGroup) {\n                  methodMappings[method] = matchedMethod!\n                  methodsSet.add(method)\n                }\n              }\n            }\n          }\n        })\n      })\n\n      _onMsg = originalOnMsg\n      const enhancedSend = ({\n        method,\n        ...rest\n      }: {\n        method: string\n        id: string\n      }) => {\n        if (method === rpcMethods) {\n          Promise.resolve().then(() => {\n            originalOnMsg(\n              jsonRpcMsg({\n                id: rest.id,\n                result: { methods: [...methodsSet] },\n              }),\n            )\n          })\n          return\n        }\n\n        const mapping = methodMappings[method]\n        if (mapping === null) {\n          if (method.split(\"_\")[2] === \"follow\") {\n            reset()\n            _send({ method, ...rest } as any)\n          } else {\n            Promise.resolve().then(() => {\n              originalOnMsg({\n                error: { code: -32603, message: `Method not found: ${method}` },\n                id: rest.id,\n              })\n            })\n          }\n        } else\n          originalSend({\n            method: mapping || method,\n            ...rest,\n          })\n      }\n\n      const bufferCopy = [...bufferedMsgs]\n      bufferedMsgs = []\n      for (let i = 0; isRunning && i < bufferCopy.length; i++)\n        enhancedSend(bufferCopy[i])\n      if (isRunning) _send = enhancedSend\n    }\n    let _onMsg = preOnMsg\n\n    const { send: originalSend, disconnect } = base((msg: any) => {\n      _onMsg(msg)\n    })\n    const reset = () => {\n      isRunning = true\n      bufferedMsgs = []\n      _send = (msg: any) => {\n        bufferedMsgs.push(msg)\n      }\n      _onMsg = preOnMsg\n      sendMethodsRequest()\n    }\n\n    let nTries = 0\n    const sendMethodsRequest = () => {\n      nTries++\n      originalSend(\n        jsonRpcMsg({\n          id: RPC_METHODS_ID,\n          method: rpcMethods,\n          params: [],\n        }),\n      )\n    }\n    sendMethodsRequest()\n\n    return {\n      send: (msg) => {\n        _send(msg)\n      },\n      disconnect() {\n        isRunning = false\n        _send = _onMsg = () => {}\n        bufferedMsgs = []\n        disconnect()\n      },\n    }\n  }\n}\n","import type { ParsedJsonRpcEnhancer } from \"@/parsed\"\n\nexport const withNumericIds: ParsedJsonRpcEnhancer = (base) => (onMsg) => {\n  let nextId = 0\n  const numberToOriginal = new Map<number, string>()\n\n  const { send: originalSend, disconnect } = base((message: any) => {\n    const { id } = message\n    if (numberToOriginal.has(id)) {\n      message.id = numberToOriginal.get(id)\n      numberToOriginal.delete(id)\n    }\n    onMsg(message)\n  })\n\n  return {\n    send: (msg: { id?: any }) => {\n      if (\"id\" in msg) {\n        numberToOriginal.set(nextId, msg.id)\n        msg.id = nextId++\n      }\n      originalSend(msg)\n    },\n    disconnect,\n  }\n}\n","import { parsed } from \"./parsed\"\nimport {\n  translate,\n  unpinHash,\n  patchChainHeadEvents,\n  fixUnorderedEvents,\n  fixUnorderedBlocks,\n  fixChainSpec,\n  fixDescendantValues,\n  fixPrematureBlocks,\n  withNumericIds,\n} from \"./parsed-enhancers\"\nimport * as methods from \"./methods\"\nexport { methods }\n\nconst withPolkadotSdkCompat = parsed(\n  withNumericIds,\n  translate,\n  fixUnorderedEvents,\n  unpinHash,\n  patchChainHeadEvents,\n  fixPrematureBlocks,\n  fixUnorderedBlocks,\n  fixChainSpec,\n  fixDescendantValues,\n)\n\nexport * from \"./parsed\"\nexport {\n  withPolkadotSdkCompat,\n  translate,\n  fixUnorderedEvents,\n  unpinHash,\n  patchChainHeadEvents,\n  fixUnorderedBlocks,\n  fixDescendantValues,\n  fixPrematureBlocks,\n  withNumericIds,\n}\n"],"names":["key","group"],"mappings":"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"}