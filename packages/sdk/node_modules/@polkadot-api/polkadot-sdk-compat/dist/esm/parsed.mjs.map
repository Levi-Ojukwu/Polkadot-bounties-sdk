{"version":3,"file":"parsed.mjs","sources":["../../src/parsed.ts"],"sourcesContent":["import { JsonRpcProvider } from \"@polkadot-api/json-rpc-provider\"\n\nexport interface ParsedJsonRpcConnection {\n  send: <T extends {}>(message: T) => void\n  disconnect: () => void\n}\n\nexport type ParsedJsonRpcProvider = (\n  onMesage: <T extends {}>(message: T) => void,\n) => ParsedJsonRpcConnection\n\nexport type ParsedJsonRpcEnhancer = (\n  base: ParsedJsonRpcProvider,\n) => ParsedJsonRpcProvider\n\nexport const toParsed = (base: JsonRpcProvider): ParsedJsonRpcProvider => {\n  let _onMsg: null | (<T extends {}>(msg: T) => void) = null\n  const { send, disconnect } = base((msg) => {\n    _onMsg?.(JSON.parse(msg))\n  })\n\n  return (onMsg) => {\n    _onMsg = onMsg\n    return {\n      send(msg) {\n        send(JSON.stringify(msg))\n      },\n      disconnect() {\n        _onMsg = null\n        disconnect()\n      },\n    }\n  }\n}\n\nexport const fromParsed = (base: ParsedJsonRpcProvider): JsonRpcProvider => {\n  let _onMsg: null | ((msg: string) => void) = null\n  const { send, disconnect } = base((msg) => {\n    _onMsg?.(JSON.stringify(msg))\n  })\n\n  return (onMsg) => {\n    _onMsg = onMsg\n    return {\n      send(msg) {\n        send(JSON.parse(msg))\n      },\n      disconnect() {\n        _onMsg = null\n        disconnect()\n      },\n    }\n  }\n}\n\nexport const parsed =\n  (\n    ...enhancers: Array<ParsedJsonRpcEnhancer>\n  ): ((base: JsonRpcProvider) => JsonRpcProvider) =>\n  (base) =>\n    fromParsed(enhancers.reduce((a, b) => b(a), toParsed(base)))\n"],"names":[],"mappings":"AAeO,MAAM,QAAA,GAAW,CAAC,IAAA,KAAiD;AACxE,EAAA,IAAI,MAAA,GAAkD,IAAA;AACtD,EAAA,MAAM,EAAE,IAAA,EAAM,UAAA,EAAW,GAAI,IAAA,CAAK,CAAC,GAAA,KAAQ;AACzC,IAAA,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,GAAG,CAAC,CAAA;AAAA,EAC1B,CAAC,CAAA;AAED,EAAA,OAAO,CAAC,KAAA,KAAU;AAChB,IAAA,MAAA,GAAS,KAAA;AACT,IAAA,OAAO;AAAA,MACL,KAAK,GAAA,EAAK;AACR,QAAA,IAAA,CAAK,IAAA,CAAK,SAAA,CAAU,GAAG,CAAC,CAAA;AAAA,MAC1B,CAAA;AAAA,MACA,UAAA,GAAa;AACX,QAAA,MAAA,GAAS,IAAA;AACT,QAAA,UAAA,EAAW;AAAA,MACb;AAAA,KACF;AAAA,EACF,CAAA;AACF;AAEO,MAAM,UAAA,GAAa,CAAC,IAAA,KAAiD;AAC1E,EAAA,IAAI,MAAA,GAAyC,IAAA;AAC7C,EAAA,MAAM,EAAE,IAAA,EAAM,UAAA,EAAW,GAAI,IAAA,CAAK,CAAC,GAAA,KAAQ;AACzC,IAAA,MAAA,GAAS,IAAA,CAAK,SAAA,CAAU,GAAG,CAAC,CAAA;AAAA,EAC9B,CAAC,CAAA;AAED,EAAA,OAAO,CAAC,KAAA,KAAU;AAChB,IAAA,MAAA,GAAS,KAAA;AACT,IAAA,OAAO;AAAA,MACL,KAAK,GAAA,EAAK;AACR,QAAA,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,GAAG,CAAC,CAAA;AAAA,MACtB,CAAA;AAAA,MACA,UAAA,GAAa;AACX,QAAA,MAAA,GAAS,IAAA;AACT,QAAA,UAAA,EAAW;AAAA,MACb;AAAA,KACF;AAAA,EACF,CAAA;AACF;AAEO,MAAM,SACX,CAAA,GACK,SAAA,KAEL,CAAC,IAAA,KACC,WAAW,SAAA,CAAU,MAAA,CAAO,CAAC,CAAA,EAAG,MAAM,CAAA,CAAE,CAAC,GAAG,QAAA,CAAS,IAAI,CAAC,CAAC;;;;"}