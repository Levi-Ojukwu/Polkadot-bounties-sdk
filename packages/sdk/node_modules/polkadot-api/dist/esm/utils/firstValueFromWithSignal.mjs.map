{"version":3,"file":"firstValueFromWithSignal.mjs","sources":["../../../src/utils/firstValueFromWithSignal.ts"],"sourcesContent":["import { AbortError } from \"@polkadot-api/utils\"\nimport { Observable, Subscription, noop } from \"rxjs\"\n\nexport function firstValueFromWithSignal<T>(\n  source: Observable<T>,\n  signal?: AbortSignal,\n): Promise<T> {\n  return new Promise((resolve, reject) => {\n    let subscription: Subscription | null = null\n    let isDone = false\n\n    const onAbort = signal\n      ? () => {\n          subscription?.unsubscribe()\n          reject(new AbortError())\n        }\n      : noop\n\n    subscription = source.subscribe({\n      next: (value) => {\n        resolve(value)\n        subscription?.unsubscribe()\n        isDone = true\n      },\n      error: (e) => {\n        signal?.removeEventListener(\"abort\", onAbort)\n        reject(e)\n        isDone = true\n      },\n      complete: () => {\n        signal?.removeEventListener(\"abort\", onAbort)\n        reject(new Error(\"Observable completed without emitting\"))\n        isDone = true\n      },\n    })\n\n    // the observable could have emitted synchronously\n    if (!isDone) signal?.addEventListener(\"abort\", onAbort)\n  })\n}\n"],"names":[],"mappings":";;;AAGO,SAAS,wBAAA,CACd,QACA,MAAA,EACY;AACZ,EAAA,OAAO,IAAI,OAAA,CAAQ,CAAC,OAAA,EAAS,MAAA,KAAW;AACtC,IAAA,IAAI,YAAA,GAAoC,IAAA;AACxC,IAAA,IAAI,MAAA,GAAS,KAAA;AAEb,IAAA,MAAM,OAAA,GAAU,SACZ,MAAM;AACJ,MAAA,YAAA,EAAc,WAAA,EAAY;AAC1B,MAAA,MAAA,CAAO,IAAI,YAAY,CAAA;AAAA,IACzB,CAAA,GACA,IAAA;AAEJ,IAAA,YAAA,GAAe,OAAO,SAAA,CAAU;AAAA,MAC9B,IAAA,EAAM,CAAC,KAAA,KAAU;AACf,QAAA,OAAA,CAAQ,KAAK,CAAA;AACb,QAAA,YAAA,EAAc,WAAA,EAAY;AAC1B,QAAA,MAAA,GAAS,IAAA;AAAA,MACX,CAAA;AAAA,MACA,KAAA,EAAO,CAAC,CAAA,KAAM;AACZ,QAAA,MAAA,EAAQ,mBAAA,CAAoB,SAAS,OAAO,CAAA;AAC5C,QAAA,MAAA,CAAO,CAAC,CAAA;AACR,QAAA,MAAA,GAAS,IAAA;AAAA,MACX,CAAA;AAAA,MACA,UAAU,MAAM;AACd,QAAA,MAAA,EAAQ,mBAAA,CAAoB,SAAS,OAAO,CAAA;AAC5C,QAAA,MAAA,CAAO,IAAI,KAAA,CAAM,uCAAuC,CAAC,CAAA;AACzD,QAAA,MAAA,GAAS,IAAA;AAAA,MACX;AAAA,KACD,CAAA;AAGD,IAAA,IAAI,CAAC,MAAA,EAAQ,MAAA,EAAQ,gBAAA,CAAiB,SAAS,OAAO,CAAA;AAAA,EACxD,CAAC,CAAA;AACH;;;;"}