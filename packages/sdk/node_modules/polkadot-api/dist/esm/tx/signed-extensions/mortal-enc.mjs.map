{"version":3,"file":"mortal-enc.mjs","sources":["../../../../src/tx/signed-extensions/mortal-enc.ts"],"sourcesContent":["import { Bytes, enhanceEncoder, u16 } from \"@polkadot-api/substrate-bindings\"\n\nfunction trailingZeroes(n: number) {\n  let i = 0\n  while (!(n & 1)) {\n    i++\n    n >>= 1\n  }\n  return i\n}\n\nconst nextPower = (n: number) => 1 << Math.ceil(Math.log2(n))\n\nexport const mortal = enhanceEncoder(\n  Bytes(2)[0],\n  (value: { period: number; startAtBlock: number }) => {\n    const period = Math.min(Math.max(nextPower(value.period), 4), 1 << 16)\n    const phase = value.startAtBlock % period\n    const factor = Math.max(period >> 12, 1)\n    const left = Math.min(Math.max(trailingZeroes(period) - 1, 1), 15)\n    const right = (phase / factor) << 4\n    return u16[0](left | right)\n  },\n)\n"],"names":[],"mappings":";;AAEA,SAAS,eAAe,CAAA,EAAW;AACjC,EAAA,IAAI,CAAA,GAAI,CAAA;AACR,EAAA,OAAO,EAAE,IAAI,CAAA,CAAA,EAAI;AACf,IAAA,CAAA,EAAA;AACA,IAAA,CAAA,KAAM,CAAA;AAAA,EACR;AACA,EAAA,OAAO,CAAA;AACT;AAEA,MAAM,SAAA,GAAY,CAAC,CAAA,KAAc,CAAA,IAAK,KAAK,IAAA,CAAK,IAAA,CAAK,IAAA,CAAK,CAAC,CAAC,CAAA;AAErD,MAAM,MAAA,GAAS,cAAA;AAAA,EACpB,KAAA,CAAM,CAAC,CAAA,CAAE,CAAC,CAAA;AAAA,EACV,CAAC,KAAA,KAAoD;AACnD,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,GAAA,CAAI,IAAA,CAAK,GAAA,CAAI,SAAA,CAAU,KAAA,CAAM,MAAM,CAAA,EAAG,CAAC,CAAA,EAAG,CAAA,IAAK,EAAE,CAAA;AACrE,IAAA,MAAM,KAAA,GAAQ,MAAM,YAAA,GAAe,MAAA;AACnC,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,GAAA,CAAI,MAAA,IAAU,IAAI,CAAC,CAAA;AACvC,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,GAAA,CAAI,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,MAAM,CAAA,GAAI,CAAA,EAAG,CAAC,CAAA,EAAG,EAAE,CAAA;AACjE,IAAA,MAAM,KAAA,GAAS,QAAQ,MAAA,IAAW,CAAA;AAClC,IAAA,OAAO,GAAA,CAAI,CAAC,CAAA,CAAE,IAAA,GAAO,KAAK,CAAA;AAAA,EAC5B;AACF;;;;"}