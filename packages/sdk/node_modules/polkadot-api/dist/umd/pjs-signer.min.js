(function(K,Q){typeof exports=="object"&&typeof module<"u"?Q(exports):typeof define=="function"&&define.amd?define(["exports"],Q):(K=typeof globalThis<"u"?globalThis:K||self,Q(K.papiPjsSigner={}))})(this,(function(K){"use strict";var Q=Object.defineProperty,mt=(e,t,n)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ae=(e,t,n)=>(mt(e,typeof t!="symbol"?t+"":t,n),n),ce={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function wt(e){const t=e.length%2,n=(e[1]==="x"?2:0)+t,s=(e.length-n)/2+t,r=new Uint8Array(s);t&&(r[0]=0|ce[e[2]]);for(let o=0;o<s;){const i=n+o*2,c=ce[e[i]],d=ce[e[i+1]];r[t+o++]=c<<4|d}return r}var Ie=class extends Uint8Array{constructor(e){super(e),Ae(this,"i",0),Ae(this,"v"),this.v=new DataView(e)}},D=e=>t=>e(t instanceof Ie?t:new Ie(t instanceof Uint8Array?t.buffer:typeof t=="string"?wt(t).buffer:t)),C=e=>{const t=e.length;let n=0;for(let r=0;r<t;r++)n+=e[r].length;const s=new Uint8Array(n);for(let r=0,o=0;r<t;r++){const i=e[r];s.set(i,o),o+=i.byteLength}return s};function ne(e,t){const n=Object.keys(e),s=n.length,r={};for(let o=0;o<s;o++){const i=n[o];r[i]=t(e[i],i)}return r}var B=(e,t)=>{const n=[e,t];return n.enc=e,n.dec=t,n},Be=(e,t)=>n=>e(t(n)),ke=(e,t)=>n=>t(e(n)),Z=([e,t],n,s)=>B(Be(e,n),ke(t,s));function bt(e,t){return D(n=>{const s=n.v[t](n.i,!0);return n.i+=e,s})}function xt(e,t){return n=>{const s=new Uint8Array(e);return new DataView(s.buffer)[t](0,n,!0),s}}function M(e,t,n){return B(xt(e,n),bt(e,t))}var k=M(1,"getUint8","setUint8"),re=M(2,"getUint16","setUint16"),V=M(4,"getUint32","setUint32"),Ue=M(8,"getBigUint64","setBigUint64");M(1,"getInt8","setInt8"),M(2,"getInt16","setInt16"),M(4,"getInt32","setInt32"),M(8,"getBigInt64","setBigInt64");var Te=e=>{const t=new Uint8Array(16),n=new DataView(t.buffer);return n.setBigInt64(0,e,!0),n.setBigInt64(8,e>>64n,!0),t},Le=e=>D(t=>{const{v:n,i:s}=t,r=n.getBigUint64(s,!0),o=n[e](s+8,!0);return t.i+=16,o<<64n|r});B(Te,Le("getBigUint64")),B(Te,Le("getBigInt64"));var _e=e=>{const t=new Uint8Array(32),n=new DataView(t.buffer);return n.setBigInt64(0,e,!0),n.setBigInt64(8,e>>64n,!0),n.setBigInt64(16,e>>128n,!0),n.setBigInt64(24,e>>192n,!0),t},Oe=e=>D(t=>{let n=t.v.getBigUint64(t.i,!0);return t.i+=8,n|=t.v.getBigUint64(t.i,!0)<<64n,t.i+=8,n|=t.v.getBigUint64(t.i,!0)<<128n,t.i+=8,n|=t.v[e](t.i,!0)<<192n,t.i+=8,n});B(_e,Oe("getBigUint64")),B(_e,Oe("getBigInt64")),Z(k,e=>e?1:0,Boolean);var Et=[k[1],re[1],V[1]],At=D(e=>{const t=e[e.i],n=t&3;if(n<3)return Et[n](e)>>>2;const s=(t>>>2)+4;e.i++;let r=0n;const o=s/8|0;let i=0n;for(let d=0;d<o;d++)r=Ue[1](e)<<i|r,i+=64n;let c=s%8;return c>3&&(r=BigInt(V[1](e))<<i|r,i+=32n,c-=4),c>1&&(r=BigInt(re[1](e))<<i|r,i+=16n,c-=2),c&&(r=BigInt(k[1](e))<<i|r),r}),It=1n<<56n,Bt=1<<24,kt=256,Ut=4294967295n,Tt=64,Lt=16384,_t=1<<30,Ot=e=>{if(e<0)throw new Error(`Wrong compact input (${e})`);const t=Number(e)<<2;if(e<Tt)return k[0](t);if(e<Lt)return re[0](t|1);if(e<_t)return V[0](t|2);let n=[new Uint8Array(1)],s=BigInt(e);for(;s>=It;)n.push(Ue[0](s)),s>>=64n;s>=Bt&&(n.push(V[0](Number(s&Ut))),s>>=32n);let r=Number(s);r>=kt&&(n.push(re[0](r)),r>>=16),r&&n.push(k[0](r));const o=C(n);return o[0]=o.length-5<<2|3,o},_=B(Ot,At),Dt=new TextEncoder,Ct=e=>{const t=Dt.encode(e);return C([_.enc(t.length),t])},St=new TextDecoder,jt=D(e=>{let t=_.dec(e);const n=new DataView(e.buffer,e.i,t);return e.i+=t,St.decode(n)}),b=B(Ct,jt),Mt=()=>{},Vt=new Uint8Array(0),x=B(()=>Vt,Mt),De=e=>e===void 0?t=>C([_.enc(t.length),t]):t=>t.length===e?t:t.slice(0,e),Ce=e=>D(t=>{const n=e===void 0?_.dec(t):e!==1/0?e:t.byteLength-t.i,s=new Uint8Array(t.buffer.slice(t.i,t.i+n));return t.i+=n,s}),q=e=>B(De(e),Ce(e));q.enc=De,q.dec=Ce;var Se=(e,t)=>{const n=Object.keys(e),s=new Map(t?.map((o,i)=>[n[i],o])??n.map((o,i)=>[o,i])),r=o=>s.get(o);return({tag:o,value:i})=>C([k.enc(r(o)),e[o](i)])},je=(e,t)=>{const n=Object.keys(e),s=new Map(t?.map((r,o)=>[r,n[o]])??n.map((r,o)=>[o,r]));return D(r=>{const o=k.dec(r),i=s.get(o),c=e[i];return{tag:i,value:c(r)}})},S=(e,...t)=>B(Se(ne(e,([n])=>n),...t),je(ne(e,([,n])=>n),...t));S.enc=Se,S.dec=je;var Me=e=>D(t=>k[1](t)>0?e(t):void 0),Ve=e=>t=>{const n=new Uint8Array(1);return t===void 0?n:(n[0]=1,C([n,e(t)]))},U=e=>B(Ve(e[0]),Me(e[1]));U.enc=Ve,U.dec=Me;var $e=(...e)=>D(t=>e.map(n=>n(t))),Ne=(...e)=>t=>C(e.map((n,s)=>n(t[s]))),$=(...e)=>B(Ne(...e.map(([t])=>t)),$e(...e.map(([,t])=>t)));$.enc=Ne,$.dec=$e;var Pe=e=>{const t=Object.keys(e);return Be($.enc(...Object.values(e)),n=>t.map(s=>n[s]))},He=e=>{const t=Object.keys(e);return ke($.dec(...Object.values(e)),n=>Object.fromEntries(n.map((s,r)=>[t[r],s])))},f=e=>B(Pe(ne(e,t=>t[0])),He(ne(e,t=>t[1])));f.enc=Pe,f.dec=He;var Re=(e,t)=>t>=0?n=>C(n.map(e)):n=>C([_.enc(n.length),C(n.map(e))]),Fe=(e,t)=>D(n=>{const s=t>=0?t:_.dec(n),r=new Array(s);for(let o=0;o<s;o++)r[o]=e(n);return r}),m=(e,t)=>B(Re(e[0],t),Fe(e[1],t));m.enc=Re,m.dec=Fe;/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function $t(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Ke(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function ae(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function qe(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function le(e){if(!Array.isArray(e))throw new Error("array expected")}function We(e,t){if(!Ke(!0,t))throw new Error(`${e}: array of strings expected`)}function Nt(e,t){if(!Ke(!1,t))throw new Error(`${e}: array of numbers expected`)}function Pt(...e){const t=o=>o,n=(o,i)=>c=>o(i(c)),s=e.map(o=>o.encode).reduceRight(n,t),r=e.map(o=>o.decode).reduce(n,t);return{encode:s,decode:r}}function Ht(e){const t=typeof e=="string"?e.split(""):e,n=t.length;We("alphabet",t);const s=new Map(t.map((r,o)=>[r,o]));return{encode:r=>(le(r),r.map(o=>{if(!Number.isSafeInteger(o)||o<0||o>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${o}". Allowed: ${e}`);return t[o]})),decode:r=>(le(r),r.map(o=>{ae("alphabet.decode",o);const i=s.get(o);if(i===void 0)throw new Error(`Unknown letter: "${o}". Allowed: ${e}`);return i}))}}function Rt(e=""){return ae("join",e),{encode:t=>(We("join.decode",t),t.join(e)),decode:t=>(ae("join.decode",t),t.split(e))}}function Xe(e,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(le(e),!e.length)return[];let s=0;const r=[],o=Array.from(e,c=>{if(qe(c),c<0||c>=t)throw new Error(`invalid integer: ${c}`);return c}),i=o.length;for(;;){let c=0,d=!0;for(let g=s;g<i;g++){const h=o[g],u=t*c,a=u+h;if(!Number.isSafeInteger(a)||u/t!==c||a-h!==u)throw new Error("convertRadix: carry overflow");const w=a/n;c=a%n;const y=Math.floor(w);if(o[g]=y,!Number.isSafeInteger(y)||y*n+c!==a)throw new Error("convertRadix: carry overflow");if(d)y?d=!1:s=g;else continue}if(r.push(c),d)break}for(let c=0;c<e.length-1&&e[c]===0;c++)r.push(0);return r.reverse()}function Ft(e){qe(e);const t=2**8;return{encode:n=>{if(!$t(n))throw new Error("radix.encode input should be Uint8Array");return Xe(Array.from(n),t,e)},decode:n=>(Nt("radix.decode",n),Uint8Array.from(Xe(n,e,t)))}}const Ge=(e=>Pt(Ft(58),Ht(e),Rt("")))("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Kt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function ue(e,t=""){if(!Number.isSafeInteger(e)||e<0){const n=t&&`"${t}" `;throw new Error(`${n}expected integer >0, got ${e}`)}}function W(e,t,n=""){const s=Kt(e),r=e?.length,o=t!==void 0;if(!s||o&&r!==t){const i=n&&`"${n}" `,c=o?` of length ${t}`:"",d=s?`length=${r}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+c+", got "+d)}return e}function ze(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function qt(e,t){W(e,void 0,"digestInto() output");const n=t.outputLen;if(e.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function se(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function de(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const Ye=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Je(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}const j=Ye?e=>e:e=>Je(e);function Wt(e){for(let t=0;t<e.length;t++)e[t]=Je(e[t]);return e}const G=Ye?e=>e:Wt;function Xt(e,t={}){const n=(r,o)=>e(o).update(r).digest(),s=e(void 0);return n.outputLen=s.outputLen,n.blockLen=s.blockLen,n.create=r=>e(r),Object.assign(n,t),Object.freeze(n)}const Gt=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),oe=BigInt(2**32-1),Qe=BigInt(32);function zt(e,t=!1){return t?{h:Number(e&oe),l:Number(e>>Qe&oe)}:{h:Number(e>>Qe&oe)|0,l:Number(e&oe)|0}}const Ze=(e,t,n)=>e>>>n|t<<32-n,et=(e,t,n)=>e<<32-n|t>>>n,Yt=(e,t,n)=>e<<64-n|t>>>n-32,Jt=(e,t,n)=>e>>>n-32|t<<64-n,Qt=(e,t)=>t,Zt=(e,t)=>e;function tt(e,t,n,s){const r=(t>>>0)+(s>>>0);return{h:e+n+(r/2**32|0)|0,l:r|0}}const nt=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),rt=(e,t,n,s)=>t+n+s+(e/2**32|0)|0,I=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),l=new Uint32Array(32);function N(e,t,n,s,r,o){const i=r[o],c=r[o+1];let d=l[2*e],g=l[2*e+1],h=l[2*t],u=l[2*t+1],a=l[2*n],w=l[2*n+1],y=l[2*s],v=l[2*s+1],E=nt(d,h,i);g=rt(E,g,u,c),d=E|0,{Dh:v,Dl:y}={Dh:v^g,Dl:y^d},{Dh:v,Dl:y}={Dh:Qt(v,y),Dl:Zt(v)},{h:w,l:a}=tt(w,a,v,y),{Bh:u,Bl:h}={Bh:u^w,Bl:h^a},{Bh:u,Bl:h}={Bh:Ze(u,h,24),Bl:et(u,h,24)},l[2*e]=d,l[2*e+1]=g,l[2*t]=h,l[2*t+1]=u,l[2*n]=a,l[2*n+1]=w,l[2*s]=y,l[2*s+1]=v}function P(e,t,n,s,r,o){const i=r[o],c=r[o+1];let d=l[2*e],g=l[2*e+1],h=l[2*t],u=l[2*t+1],a=l[2*n],w=l[2*n+1],y=l[2*s],v=l[2*s+1],E=nt(d,h,i);g=rt(E,g,u,c),d=E|0,{Dh:v,Dl:y}={Dh:v^g,Dl:y^d},{Dh:v,Dl:y}={Dh:Ze(v,y,16),Dl:et(v,y,16)},{h:w,l:a}=tt(w,a,v,y),{Bh:u,Bl:h}={Bh:u^w,Bl:h^a},{Bh:u,Bl:h}={Bh:Yt(u,h,63),Bl:Jt(u,h,63)},l[2*e]=d,l[2*e+1]=g,l[2*t]=h,l[2*t+1]=u,l[2*n]=a,l[2*n+1]=w,l[2*s]=y,l[2*s+1]=v}function en(e,t={},n,s,r){if(ue(n),e<0||e>n)throw new Error("outputLen bigger than keyLen");const{key:o,salt:i,personalization:c}=t;if(o!==void 0&&(o.length<1||o.length>n))throw new Error('"key" expected to be undefined or of length=1..'+n);i!==void 0&&W(i,s,"salt"),c!==void 0&&W(c,r,"personalization")}class tn{buffer;buffer32;finished=!1;destroyed=!1;length=0;pos=0;blockLen;outputLen;constructor(t,n){ue(t),ue(n),this.blockLen=t,this.outputLen=n,this.buffer=new Uint8Array(t),this.buffer32=se(this.buffer)}update(t){ze(this),W(t);const{blockLen:n,buffer:s,buffer32:r}=this,o=t.length,i=t.byteOffset,c=t.buffer;for(let d=0;d<o;){this.pos===n&&(G(r),this.compress(r,0,!1),G(r),this.pos=0);const g=Math.min(n-this.pos,o-d),h=i+d;if(g===n&&!(h%4)&&d+g<o){const u=new Uint32Array(c,h,Math.floor((o-d)/4));G(u);for(let a=0;d+n<o;a+=r.length,d+=n)this.length+=n,this.compress(u,a,!1);G(u);continue}s.set(t.subarray(d,d+g),this.pos),this.pos+=g,this.length+=g,d+=g}return this}digestInto(t){ze(this),qt(t,this);const{pos:n,buffer32:s}=this;this.finished=!0,de(this.buffer.subarray(n)),G(s),this.compress(s,0,!0),G(s);const r=se(t);this.get().forEach((o,i)=>r[i]=j(o))}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){const{buffer:n,length:s,finished:r,destroyed:o,outputLen:i,pos:c}=this;return t||=new this.constructor({dkLen:i}),t.set(...this.get()),t.buffer.set(n),t.destroyed=o,t.finished=r,t.length=s,t.pos=c,t.outputLen=i,t}clone(){return this._cloneInto()}}class nn extends tn{v0l=I[0]|0;v0h=I[1]|0;v1l=I[2]|0;v1h=I[3]|0;v2l=I[4]|0;v2h=I[5]|0;v3l=I[6]|0;v3h=I[7]|0;v4l=I[8]|0;v4h=I[9]|0;v5l=I[10]|0;v5h=I[11]|0;v6l=I[12]|0;v6h=I[13]|0;v7l=I[14]|0;v7h=I[15]|0;constructor(t={}){const n=t.dkLen===void 0?64:t.dkLen;super(128,n),en(n,t,64,16,16);let{key:s,personalization:r,salt:o}=t,i=0;if(s!==void 0&&(W(s,void 0,"key"),i=s.length),this.v0l^=this.outputLen|i<<8|65536|1<<24,o!==void 0){W(o,void 0,"salt");const c=se(o);this.v4l^=j(c[0]),this.v4h^=j(c[1]),this.v5l^=j(c[2]),this.v5h^=j(c[3])}if(r!==void 0){W(r,void 0,"personalization");const c=se(r);this.v6l^=j(c[0]),this.v6h^=j(c[1]),this.v7l^=j(c[2]),this.v7h^=j(c[3])}if(s!==void 0){const c=new Uint8Array(this.blockLen);c.set(s),this.update(c)}}get(){let{v0l:t,v0h:n,v1l:s,v1h:r,v2l:o,v2h:i,v3l:c,v3h:d,v4l:g,v4h:h,v5l:u,v5h:a,v6l:w,v6h:y,v7l:v,v7h:E}=this;return[t,n,s,r,o,i,c,d,g,h,u,a,w,y,v,E]}set(t,n,s,r,o,i,c,d,g,h,u,a,w,y,v,E){this.v0l=t|0,this.v0h=n|0,this.v1l=s|0,this.v1h=r|0,this.v2l=o|0,this.v2h=i|0,this.v3l=c|0,this.v3h=d|0,this.v4l=g|0,this.v4h=h|0,this.v5l=u|0,this.v5h=a|0,this.v6l=w|0,this.v6h=y|0,this.v7l=v|0,this.v7h=E|0}compress(t,n,s){this.get().forEach((d,g)=>l[g]=d),l.set(I,16);let{h:r,l:o}=zt(BigInt(this.length));l[24]=I[8]^o,l[25]=I[9]^r,s&&(l[28]=~l[28],l[29]=~l[29]);let i=0;const c=Gt;for(let d=0;d<12;d++)N(0,4,8,12,t,n+2*c[i++]),P(0,4,8,12,t,n+2*c[i++]),N(1,5,9,13,t,n+2*c[i++]),P(1,5,9,13,t,n+2*c[i++]),N(2,6,10,14,t,n+2*c[i++]),P(2,6,10,14,t,n+2*c[i++]),N(3,7,11,15,t,n+2*c[i++]),P(3,7,11,15,t,n+2*c[i++]),N(0,5,10,15,t,n+2*c[i++]),P(0,5,10,15,t,n+2*c[i++]),N(1,6,11,12,t,n+2*c[i++]),P(1,6,11,12,t,n+2*c[i++]),N(2,7,8,13,t,n+2*c[i++]),P(2,7,8,13,t,n+2*c[i++]),N(3,4,9,14,t,n+2*c[i++]),P(3,4,9,14,t,n+2*c[i++]);this.v0l^=l[0]^l[16],this.v0h^=l[1]^l[17],this.v1l^=l[2]^l[18],this.v1h^=l[3]^l[19],this.v2l^=l[4]^l[20],this.v2h^=l[5]^l[21],this.v3l^=l[6]^l[22],this.v3h^=l[7]^l[23],this.v4l^=l[8]^l[24],this.v4h^=l[9]^l[25],this.v5l^=l[10]^l[26],this.v5h^=l[11]^l[27],this.v6l^=l[12]^l[28],this.v6h^=l[13]^l[29],this.v7l^=l[14]^l[30],this.v7h^=l[15]^l[31],de(l)}destroy(){this.destroyed=!0,de(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const he=Xt(e=>new nn(e)),st=new TextEncoder().encode("SS58PRE"),fe=2,rn=e=>{try{const t=Ge.decode(e),n=t.subarray(0,t[0]&64?2:1),s=t.subarray(n.length,t.length-fe),r=t.subarray(n.length+s.length),o=he(Uint8Array.of(...st,...n,...s),{dkLen:64}).subarray(0,fe);return r[0]===o[0]&&r[1]===o[1]?{isValid:!0,ss58Format:sn(n),publicKey:s.slice()}:{isValid:!1}}catch{return{isValid:!1}}},sn=e=>{const t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.byteLength===1?t.getUint8(0):t.getUint16(0)},on=e=>{const t=e<64?Uint8Array.of(e):Uint8Array.of((e&252)>>2|64,e>>8|(e&3)<<6);return n=>{const s=he(Uint8Array.of(...st,...t,...n),{dkLen:64}).subarray(0,fe);return Ge.encode(Uint8Array.of(...t,...n,...s))}};function cn(e,t){return n=>{const s=rn(n);if(!s.isValid)throw new Error("Invalid checksum");const{publicKey:r}=s;if(r.length!==e)throw new Error("Invalid public key length");return r}}const an=(e=42,t=32)=>Z(q(t),cn(t),on(e)),ot="0123456789abcdef";function H(e){const t=new Array(e.length+1);t[0]="0x";for(let n=0;n<e.length;){const s=e[n++];t[n]=ot[s>>4]+ot[s&15]}return t.join("")}const pe={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function ee(e){const t=e.length%2,n=(e[1]==="x"?2:0)+t,s=(e.length-n)/2+t,r=new Uint8Array(s);t&&(r[0]=0|pe[e[2]]);for(let o=0;o<s;){const i=n+o*2,c=pe[e[i]],d=pe[e[i+1]];r[t+o++]=c<<4|d}return r}const it=(...e)=>{const t=Array.isArray(e[0])?e[0]:e,n=t.reduce((r,o)=>r+o.byteLength,0),s=new Uint8Array(n);for(let r=0,o=0;r<t.length;r++){const i=t[r];s.set(i,o),o+=i.byteLength}return s},p=Z(_,e=>e,Number),ln=Z(_,e=>e,BigInt),ct=e=>{const t=q.enc(e);return n=>t(ee(n))},at=e=>{const t=q.dec(e);return n=>H(t(n))},R=e=>B(ct(e),at(e));R.enc=ct,R.dec=at;const z=(e,t)=>{const n=e;return n.inner=t,n},ve=e=>z(f(e),e);ve.enc=e=>z(f.enc(e),e),ve.dec=e=>z(f.dec(e),e);const ye=e=>z(U(e),e);ye.enc=e=>z(U.enc(e),e),ye.dec=e=>z(U.dec(e),e);const L=m(b),lt=U(b),un=S({bool:x,char:x,str:x,u8:x,u16:x,u32:x,u64:x,u128:x,u256:x,i8:x,i16:x,i32:x,i64:x,i128:x,i256:x}),ut=m(f({name:lt,type:p,typeName:lt,docs:L})),dn=f({len:V,type:p}),hn=f({bitStoreType:p,bitOrderType:p}),fn=m(f({name:b,fields:ut,index:k,docs:L})),pn=S({composite:ut,variant:fn,sequence:p,array:dn,tuple:m(p),primitive:un,compact:p,bitSequence:hn}),vn=f({name:b,type:U(p)}),yn=m(vn),gn=f({id:p,path:L,params:yn,def:pn,docs:L}),ge=m(gn),Y=S({NotDeprecated:x,DeprecatedWithoutNote:x,Deprecated:f({note:b,since:U(b)})}),mn=m(f({index:k,deprecation:S({DeprecatedWithoutNote:x,Deprecated:f({note:b,since:U(b)})},[1,2])})),me={name:b,inputs:m(f({name:b,type:p})),output:p,docs:L},wn=f({name:b,methods:m(f(me)),docs:L}),bn=f({name:b,methods:m(f({...me,deprecationInfo:Y})),docs:L,version:p,deprecationInfo:Y}),xn=f({id:R(32),...me,deprecationInfo:Y}),En=S({Blake2128:x,Blake2256:x,Blake2128Concat:x,Twox128:x,Twox256:x,Twox64Concat:x,Identity:x}),An=m(En),In=f({hashers:An,key:p,value:p}),dt={name:b,modifier:k,type:S({plain:p,map:In}),fallback:R(),docs:L},we=U(p),ht={name:b,storage:U(f({prefix:b,items:m(f(dt))})),calls:we,events:we,constants:m(f({name:b,type:p,value:R(),docs:L})),errors:we,index:k},Bn={...ht,docs:L},be=U(f({type:p,deprecationInfo:mn})),kn={name:b,storage:U(f({prefix:b,items:m(f({...dt,deprecationInfo:Y}))})),calls:be,events:be,constants:m(f({name:b,type:p,value:R(),docs:L,deprecationInfo:Y})),errors:be,associatedTypes:m(f({name:b,type:p,docs:L})),viewFns:m(xn),index:k,docs:L,deprecationInfo:Y},Un=new Uint8Array,ft=e=>B(()=>Un,()=>e),Tn=f({type:p,version:k,signedExtensions:m(f({identifier:b,type:p,additionalSigned:p}))}),Ln=f({lookup:ge,pallets:m(f({...ht,docs:ft([])})),extrinsic:Tn,type:p,apis:ft([])}),_n=f({version:k,address:p,call:p,signature:p,extra:p,signedExtensions:m(f({identifier:b,type:p,additionalSigned:p}))}),On=f({lookup:ge,pallets:m(f(Bn)),extrinsic:_n,type:p,apis:m(wn),outerEnums:f({call:p,event:p,error:p}),custom:m($(b,f({type:p,value:R()})))}),Dn=f({version:m(k),address:p,call:p,signature:p,signedExtensionsByVersion:m($(k,m(p))),signedExtensions:m(f({identifier:b,type:p,additionalSigned:p}))}),Cn=f({lookup:ge,pallets:m(f(kn)),extrinsic:Dn,apis:m(bn),outerEnums:f({call:p,event:p,error:p}),custom:m($(b,f({type:p,value:R()})))}),pt=()=>{throw new Error("Unsupported metadata version!")},T=B(pt,pt),ie=f({magicNumber:V,metadata:S({v0:T,v1:T,v2:T,v3:T,v4:T,v5:T,v6:T,v7:T,v8:T,v9:T,v10:T,v11:T,v12:T,v13:T,v14:Ln,v15:On,v16:Cn})}),xe=q(),Sn=U(xe),jn=$(_,xe),Mn=e=>{try{return ie.dec(e)}catch{}try{return ie.dec(Sn.dec(e))}catch{}try{return ie.dec(xe.dec(e))}catch{}try{return ie.dec(jn.dec(e)[1])}catch{}throw null},Vn=e=>{if("magicNumber"in e&&(e=e.metadata),"tag"in e){if(e.tag!=="v14"&&e.tag!=="v15"&&e.tag!=="v16")throw new Error("Only metadata 14, 15, and 16 are supported");e=e.value}if("signedExtensionsByVersion"in e.extrinsic)return{version:16,...e};if("custom"in e){const{lookup:r,extrinsic:o,custom:i,apis:c,pallets:d,outerEnums:g}=e;return{version:15,lookup:r,pallets:d.map(h=>({...h,calls:h.calls!=null?{type:h.calls}:void 0,events:h.events!=null?{type:h.events}:void 0,errors:h.errors!=null?{type:h.errors}:void 0,viewFns:[],associatedTypes:[]})),extrinsic:{...o,version:[o.version]},apis:c,outerEnums:g,custom:i}}const{lookup:t,extrinsic:n,pallets:s}=e;return{version:14,lookup:t,pallets:s.map(r=>({...r,calls:r.calls!=null?{type:r.calls}:void 0,events:r.events!=null?{type:r.events}:void 0,errors:r.errors!=null?{type:r.errors}:void 0,viewFns:[],associatedTypes:[]})),extrinsic:{...n,version:[n.version]},apis:[]}},X={bare:0,0:"bare",general:1,1:"general",signed:2,2:"signed"},$n=Z(k,({version:e,type:t})=>e+(X[t]<<6),e=>{const t=e&63,n=e>>6;if(t===4&&(n===X.bare||n===X.signed))return{version:t,type:X[n]};if(t===5&&(n===X.bare||n===X.general))return{version:t,type:X[n]};throw new Error(`ExtrinsicFormat ${e} not valid`)}),Nn={dkLen:32},Pn=e=>he(e,Nn),vt=(e,t)=>e.type==="array"&&e.len===t&&e.value.type==="primitive"&&e.value.value==="u8",F={type:"void"},Hn=(e,t=()=>null)=>{const n=new Map,s=new Set,r=h=>u=>{let a=n.get(u);if(a)return a;if(s.has(u)){const y={id:u};return n.set(u,y),y}s.add(u);const w=h(u);return a=n.get(u),a?Object.assign(a,w):(a={id:u,...w},n.set(u,a)),s.delete(u),a};let o=!0,i=!0;const c=r(h=>{const u=t(e[h]);if(u)return u;const{def:a,path:w,params:y}=e[h];if(a.tag==="composite"){if(a.value.length===0)return F;if(a.value.length===1){const v=c(a.value[0].type);return o&&w.at(-1)==="AccountId32"&&vt(v,32)?(o=!1,{type:"AccountId32"}):i&&w.at(-1)==="AccountId20"&&vt(v,20)?(i=!1,{type:"AccountId20"}):v}return d(a.value)}if(a.tag==="variant"){if(w.length===1&&w[0]==="Option"&&y.length===1&&y[0].name==="T"){const A=c(y[0].type);return A.type==="void"?{type:"primitive",value:"bool"}:{type:"option",value:A}}if(w.length===1&&w[0]==="Result"&&y.length===2&&y[0].name==="T"&&y[1].name==="E")return{type:"result",value:{ok:c(y[0].type),ko:c(y[1].type)}};if(a.value.length===0)return F;const v={},E={};return a.value.forEach(A=>{const O=A.name;if(E[O]=A.docs,A.fields.length===0){v[O]={...F,idx:A.index};return}if(A.fields.length===1&&!A.fields[0].name){v[O]={type:"lookupEntry",value:c(A.fields[0].type),idx:A.index};return}v[O]={...d(A.fields),idx:A.index}}),{type:"enum",value:v,innerDocs:E}}if(a.tag==="sequence")return{type:"sequence",value:c(a.value)};if(a.tag==="array"){const{len:v}=a.value,E=c(a.value.type);return!v||E.type==="void"?F:v>1?{type:"array",value:E,len:a.value.len}:E}if(a.tag==="tuple")return a.value.length===0?F:a.value.length>1?g(a.value.map(v=>c(v)),a.value.map(v=>e[v].docs)):c(a.value[0]);if(a.tag==="primitive")return{type:"primitive",value:a.value.tag};if(a.tag==="compact"){const v=c(a.value);return v.type==="void"?F:{type:"compact",isBig:Number(v.value.slice(1))>32,size:v.value}}return{type:a.tag,isLSB:(e[a.value.bitOrderType].path.at(-1)??"LSB").toUpperCase().startsWith("LSB")}}),d=h=>{let u=!0;const a={},w={};return h.forEach((y,v)=>{u=u&&!!y.name;const E=y.name||v,A=c(y.type);A.type!=="void"&&(a[E]=A,w[E]=y.docs)}),u?{type:"struct",value:a,innerDocs:w}:g(Object.values(a),Object.values(w))},g=(h,u)=>{if(h.every(a=>a.id===h[0].id)&&u.every(a=>!a.length)){const[a]=h;return a.type==="void"?F:{type:"array",value:h[0],len:h.length}}return{type:"tuple",value:h,innerDocs:u}};return c},Rn=e=>{const t=Hn(e.lookup,({def:r})=>{if(r.tag==="composite"){const o=n(r);if(o)return{type:"enum",innerDocs:{},value:Object.fromEntries(e.pallets.map(i=>[i.name,i.errors==null?{...F,idx:i.index}:{type:"lookupEntry",value:t(i.errors.type),idx:i.index}])),byteLength:o}}return null});function n(r){if(!(r.value.length===2&&r.value[0].name==="index"&&r.value[1].name==="error"))return null;const i=t(r.value[0].type),c=t(r.value[1].type);return i.type==="primitive"&&i.value==="u8"&&c.type==="array"&&c.value.type==="primitive"&&c.value.value==="u8"?1+c.len:null}return Object.assign(t,{metadata:e,call:"call"in e.extrinsic?e.extrinsic.call:e.lookup[e.extrinsic.type]?.params.find(i=>i.name==="Call")?.type??null})},Ee=()=>new Error("Unkown signer"),Fn=e=>{const{extrinsic:t}=e,n=Rn(e);let s,r;if("address"in t)s=n(t.address),r=n(t.signature);else{const o=Object.fromEntries(e.lookup[t.type].params.filter(i=>i.type!=null).map(i=>[i.name,n(i.type)]));if(s=o.Address,r=o.Signature,!s||!r)throw Ee()}if(s.type==="AccountId20"&&r.type==="array"&&r.len===65&&r.value.type==="primitive"&&r.value.value==="u8")return[1,[]];if(r.type!=="enum"||["Ecdsa","Ed25519","Sr25519"].some(o=>!(o in r.value)))throw Ee();if(s.type==="enum"){const o=s.value.Id;if(o.type==="lookupEntry"&&o.value.type==="AccountId32")return[0,[o.idx]]}else if(s.type==="AccountId32")return[0,[]];throw Ee()},Kn=(e,t,n,s,r,o)=>{const[i,c]=Fn(e),d=it([$n.enc({version:4,type:"signed"}),i===1?t:new Uint8Array([...c,...t]),n,...s,r]);return it([_.enc(d.length),d])},J=(e,t)=>{let n=e.toString(16);n=(n.length%2?"0":"")+n;const s=Math.max(0,(t||0)-n.length/2);return"0x"+"00".repeat(s)+n},qn=({additionalSigned:e})=>({genesisHash:H(e)}),Wn=({value:e})=>({nonce:J(_.dec(e),4)}),Xn=({additionalSigned:e})=>({transactionVersion:J(V.dec(e),4)}),Gn=ve({tip:_,asset:ye(q(1/0))}).dec;var yt=Object.freeze({__proto__:null,ChargeAssetTxPayment:({value:e})=>{const{tip:t,asset:n}=Gn(e);return{...n?{assetId:H(n)}:{},tip:J(t,16)}},ChargeTransactionPayment:({value:e})=>({tip:J(ln.dec(e),16)}),CheckGenesis:qn,CheckMetadataHash:({value:e,additionalSigned:t})=>e.length&&e[0]?{mode:1,metadataHash:H(t.length?t.slice(1):t)}:{},CheckMortality:({value:e,additionalSigned:t},n)=>({era:H(e),blockHash:H(t),blockNumber:J(n,4)}),CheckNonce:Wn,CheckSpecVersion:({additionalSigned:e})=>({specVersion:J(V.dec(e),4)}),CheckTxVersion:Xn});const zn=an().enc,Yn=e=>e.startsWith("0x")?ee(e):zn(e);function gt(e,t,n){const s=i=>n({address:e,data:H(i),type:"bytes"}).then(({signature:c})=>ee(c)),r=Yn(e);return{publicKey:r,signTx:async(i,c,d,g,h=Pn)=>{const u=Vn(Mn(d)),a={};a.signedExtensions=[];const{version:w}=u.extrinsic,y=[];u.extrinsic.signedExtensions.map(({identifier:O})=>{const te=c[O];if(!te)throw new Error(`Missing ${O} signed-extension`);if(y.push(te.value),a.signedExtensions.push(O),!yt[O]){if(te.value.length===0&&te.additionalSigned.length===0)return;throw new Error(`PJS does not support this signed-extension: ${O}`)}Object.assign(a,yt[O](te,g))});const v=w.includes(4)?4:null;if(v==null)throw new Error("Only extrinsic v4 is supported");a.address=e,a.method=H(i),a.version=v,a.withSignedTransaction=!0;const E=await t(a),A=E.signedTransaction;return A?typeof A=="string"?ee(A):A:Kn(u,r,ee(E.signature),y,i)},signBytes:s}}const Jn=new Set(["ed25519","sr25519","ecdsa","ethereum"]),Qn=async(e,t)=>{let n=window.injectedWeb3?.[e];if(!n)throw new Error(`Unavailable extension: "${e}"`);const s=await n.enable(t),r=s.signer.signPayload.bind(s.signer),o=s.signer.signRaw.bind(s.signer),i=h=>h.filter(({type:u})=>Jn.has(u)).map(u=>{const a=gt(u.address,r,o);return{...u,polkadotSigner:a}});let c=i(await s.accounts.get());const d=new Set,g=s.accounts.subscribe(h=>{c=i(h),d.forEach(u=>{u(c)})});return{name:e,getAccounts:()=>c,subscribe:h=>(d.add(h),()=>{d.delete(h)}),disconnect:()=>{g()}}},Zn=()=>{const{injectedWeb3:e}=window;return e?Object.keys(e):[]};K.connectInjectedExtension=Qn,K.getInjectedExtensions=Zn,K.getPolkadotSignerFromPjs=gt}));
